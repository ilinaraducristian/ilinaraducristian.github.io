{"version":3,"sources":["types/Channel.ts","reportWebVitals.ts","state-management/slices/keycloak.slice.ts","state-management/slices/socketio.slice.ts","state-management/slices/mediasoup.slice.ts","state-management/slices/data/channel.reducers.ts","state-management/selectors/data.selector.ts","state-management/slices/data/server.reducers.ts","state-management/slices/data/data.slice.ts","config.ts","mediasoup.ts","socketio.ts","state-management/apis/socketio.ts","state-management/store.ts","keycloak.ts","mock-data.ts","components/server/Server.component.tsx","components/server/ServersPanel.component.tsx","DnDItemTypes.ts","components/DropHandle.component.tsx","components/channels/ChannelDropHandle.component.tsx","svg/Channel.svg.tsx","components/channels/ChannelButton.component.tsx","components/channels/VoiceChannel.component.tsx","components/channels/TextChannel.component.tsx","state-management/selectors/channel.selector.ts","components/channels/ChannelsList.component.tsx","components/dropdown/Dropdown.component.tsx","svg/Arrow.svg.tsx","components/group/Group.component.tsx","state-management/selectors/server.selector.ts","components/group/GroupsList.component.tsx","components/channels/ChannelsPanel.component.tsx","svg/Members.svg.tsx","components/message/Message.component.tsx","svg/Plus.svg.tsx","components/message/MessageInput.component.tsx","svg/GIF.svg.tsx","trie.ts","components/message/EmojiContainer.component.tsx","components/message/MessageInputContainer.component.tsx","components/message/MessagesPanel.component.tsx","components/member/Member.component.tsx","components/member/MembersPanel.component.tsx","components/content/ContentPanel.component.tsx","components/overlay/AddServerOverlay.component.tsx","components/overlay/CreateChannelOverlay.component.tsx","components/overlay/CreateGroupOverlay.component.tsx","components/overlay/CreateServerOverlay.component.tsx","components/overlay/InvitationOverlay.component.tsx","components/overlay/JoinServerOverlay.component.tsx","components/app/App.component.tsx","components/AuthProvider.component.tsx","index.tsx"],"names":["ChannelType","reportWebVitals","onPerfEntry","then","getCLS","getFID","getFCP","getLCP","getTTFB","keycloakSlice","createSlice","name","initialState","isAuthenticated","token","subject","reducers","authenticate","state","action","payload","deauthenticate","updateToken","actions","selectAuthenticated","keycloak","authenticated","socketioSlice","connected","connect","disconnect","selectConnected","socketio","mediasoupSlice","isLoaded","load","channelReducers","editMessage","server","servers","find","id","serverId","undefined","message","channels","concat","groups","map","group","flat","filter","channel","type","Text","channelId","messages","messageId","text","deleteMessage","messageIndex","findIndex","replyId","forEach","splice","joinVoiceChannel","joinedVoiceChannel","leaveVoiceChannel","addChannelUsers","Voice","length","u1","existingUserIndex","users","user","userId","push","selectIsBackendInitialized","data","isBackendInitialized","selectSelectedChannel","selectedChannel","selectSelectedServer","selectedServer","selectOverlay","overlay","selectUsers","selectJoinedChannel","groupId","foundChannel","selectServers","serverReducers","setInvitation","invitation","addServer","s1Index","s1","addMessages","m1","addUser","addMember","member","members","memberIndex","addChannel","channelIndex","c1","addGroup","groupIndex","g1","setChannelsOrder","newChannel","order","initializeBackend","setOverlay","closeOverlay","selectServer","selectChannel","dataSlice","config","offline","backend","socketIoUrl","url","realm","clientId","mediasoup","Device","notificationSound","MediaStream","AudioContext","Audio","emitAck","ev","args","Promise","resolve","socket","emit","socketio_Socket","socketio_io","autoConnect","transports","Object","assign","auth","on","a","loaded","routerRtpCapabilities","store","dispatch","window","location","reload","document","hidden","currentTime","play","socketioApi","createApi","reducerPath","baseQuery","endpoints","builder","getUserData","query","joinServer","createServer","createChannel","createGroup","getMessages","createInvitation","transformResponse","response","useLazyGetUserDataQuery","useLazyJoinServerQuery","useLazyCreateServerQuery","useLazyCreateChannelQuery","useLazyCreateGroupQuery","useLazyGetMessagesQuery","useLazyCreateInvitationQuery","useLazyEditMessageQuery","useLazyDeleteMessageQuery","configureStore","reducer","keycloakReducer","socketioReducer","mediasoupReducer","dataReducer","middleware","getDefaultMiddleware","useAppDispatch","useDispatch","useAppSelector","useSelector","Keycloak","onAuthRefreshSuccess","onAuthSuccess","lorem","LoremIpsum","sentencesPerParagraph","max","min","wordsPerSentence","mockUsers","username","firstName","lastName","mockServers","invitationExp","Array","fill","_","index","timestamp","Date","toString","generateParagraphs","isReply","Li","styled","li","Button","button","ServerComponent","onSelectServer","className","onClick","Ol","ol","ServersPanelComponent","selectServerAction","setOverlayAction","ItemTypes","DropHandleComponent","div","props","Hidden","ChannelDropHandleComponent","useState","setHidden","handleDrop","useCallback","item","handleHover","handleCollect","monitor","isOver","useDrop","accept","drop","hover","collect","useEffect","ref","ChannelSVG","isPrivate","width","height","viewBox","d","fillRule","clipRule","ChannelButtonComponent","Ul","ul","VoiceChannelComponent","joined","useRef","createProducer","navigator","mediaDevices","getUserMedia","audio","localStream","transportParameters","sendTransport","createSendTransport","cb","dtlsParameters","parameters","kind","rtpParameters","appData","producerId","produce","track","getAudioTracks","current","useDrag","drag","_user","i","TextChannelComponent","fetch","isSuccess","selectChannelAction","offset","selectSelectedChannelMessages","channelMapper","ChannelsListComponent","foundGroup","selectSelectedServerChannelsByGroupId","from","sort","ch1","ch2","Div","DropdownComponent","setIsDropdownShown","showCreateChannelOverlay","showCreateGroupOverlay","SvgArrow","svg","isCollapsed","ArrowSVG","ArrowXSVG","stroke","strokeLinecap","ButtonCreateChannel","GroupComponent","setIsExpanded","selectSelectedServerGroups","selectSelectedServerMembers","GroupsListComponent","Span","span","ChannelsPanelComponent","isDropdownShown","DndProvider","HTML5Backend","MembersSVG","x","y","aria-hidden","DivMessageContainer","DivContainer","DivActions","Time","time","SpanUsername","SpanMessage","MessageComponent","reply","setActions","fetchEditMessage","isFetchingEditMessage","isFetching","isSuccessEditMessage","fetchDeleteMessage","isFetchingDeleteMessage","isSuccessDeleteMessage","isEditing","setIsEditing","textRef","oldMessage","setOldMessage","editMessageAction","innerText","deleteMessageAction","onMouseEnter","onMouseLeave","dateTime","toISOString","getHours","getMinutes","suppressContentEditableWarning","contentEditable","PlusSVG","MessageInputComponent","onKeyDown","onKeyUp","onCopy","event","preventDefault","selection","getSelection","clipboard","clipboardData","setData","role","GIFSVG","trie","TrieSearch","ignoreCase","splitOnRegEx","expandRegexes","emojis","emoji","String","fromCodePoint","shortcut","EmojiContainerComponent","forwardRef","foundEmojis","curIndex","setCurIndex","useImperativeHandle","move","up","getEmoji","result","highlighted","Footer","footer","DivEmoji","MessageInputContainerComponent","isReplying","messageSent","emojiRef","isEmojiShown","setIsEmojiShown","setFoundEmojis","sendInputFieldContent","target","findLastIndexOfColon","cursorPosition","anchorOffset","lastIndexOfColon","lastIndexOf","shouldDisplayEmojiPanel","lastIndexObject","substring","indexOf","charCodeAt","search","includes","code","setPosition","focusNode","shouldDisplayEmojiPanelEventHandler","DivBodyMain","DivBodyMessages","MessagesPanelComponent","messagesList","status","setOffset","beginning","setBeginning","setIsReplying","setReplyId","scroll","scrollHeight","onScroll","scrollTop","b","parse","MemberComponent","MembersPanelComponent","selectedMembers","DivMembers","DivContentBody","Header","header","DivHeader","ContentPanelComponent","isMembersSelected","setIsMembersSelected","AddServerOverlayComponent","CreateChannelOverlayComponent","channelName","value","CreateGroupOverlayComponent","groupName","CreateServerOverlayComponent","InvitationOverlayComponent","setStatus","copyToClipboard","writeText","console","error","JoinServerOverlayComponent","overlayToComponent","AppComponent","joinedChannel","init","onLoad","silentCheckSsoRedirectUri","origin","login","alert","AuthProvider","children","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.5129b98d.chunk.js","sourcesContent":["import Message from \"types/Message\";\n\nexport enum ChannelType {\n  Text = \"text\",\n  Voice = \"voice\"\n}\n\nexport type VoiceChannel = Channel & {\n  users: { socketId: string, userId: string }[]\n}\n\nexport type TextChannel = Channel & {\n  messages: Message[]\n}\n\ntype Channel = {\n  id: number,\n  serverId: number,\n  groupId: number | null,\n  type: ChannelType,\n  name: string,\n  order: number,\n}\n\nexport default Channel;","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import {createSlice, SliceCaseReducers} from \"@reduxjs/toolkit\";\n\ntype KeycloakSliceState = {\n  isAuthenticated: boolean,\n  token: string,\n  subject: string\n}\n\nexport const keycloakSlice = createSlice<KeycloakSliceState, SliceCaseReducers<KeycloakSliceState>, string>({\n  name: \"keycloak\",\n  initialState: {\n    isAuthenticated: false,\n    token: \"\",\n    subject: \"\"\n  },\n  reducers: {\n    authenticate(state, action) {\n      state.isAuthenticated = true;\n      state.token = action.payload.token;\n      state.subject = action.payload.subject;\n    },\n    deauthenticate(state) {\n      state.isAuthenticated = false;\n      state.token = \"\";\n      state.subject = \"\";\n    },\n    updateToken(state, action) {\n      state.token = action.payload.token;\n    }\n  }\n});\n\nexport const {authenticate, deauthenticate, updateToken} = keycloakSlice.actions;\nexport const selectAuthenticated = (state: any): boolean => state.keycloak.authenticated;\nexport const selectSubject = (state: any): string => state.keycloak.subject;\n\nexport default keycloakSlice.reducer;","import {createSlice} from \"@reduxjs/toolkit\";\n\nexport const socketioSlice = createSlice({\n  name: \"socketio\",\n  initialState: {\n    connected: false\n  },\n  reducers: {\n    connect(state) {\n      state.connected = true;\n    },\n    disconnect(state) {\n      state.connected = false;\n    }\n  }\n});\n\nexport const {connect, disconnect} = socketioSlice.actions;\nexport const selectConnected = (state: any): boolean => state.socketio.connected;\n\nexport default socketioSlice.reducer;","import {createSlice} from \"@reduxjs/toolkit\";\nimport {SliceCaseReducers} from \"@reduxjs/toolkit/src/createSlice\";\n\ntype MediasoupSliceState = {\n  isLoaded: boolean\n}\n\nexport const mediasoupSlice = createSlice<MediasoupSliceState, SliceCaseReducers<MediasoupSliceState>, string>({\n  name: \"mediasoup\",\n  initialState: {\n    isLoaded: false\n  },\n  reducers: {\n    load(state) {\n      state.isLoaded = true;\n    }\n  }\n});\n\nexport const {load} = mediasoupSlice.actions;\n\nexport default mediasoupSlice.reducer;","import {ChannelType, TextChannel, VoiceChannel} from \"types/Channel\";\nimport {DataSliceState} from \"state-management/slices/data/data.slice\";\n\nconst channelReducers = {\n  editMessage(state: DataSliceState, {payload}: { payload: { serverId: number, channelId: number, messageId: number, text: string } }) {\n    const server = state.servers.find(server => server.id === payload.serverId);\n    if (server === undefined) return;\n    const message = (server.channels\n        .concat(server.groups.map(group => group.channels).flat())\n        .filter(channel => channel.type === ChannelType.Text)\n        .find(channel => channel.id === payload.channelId) as TextChannel | undefined)?.messages\n        .find(message => message.id === payload.messageId);\n    if (message === undefined) return;\n    message.text = payload.text;\n  },\n  deleteMessage(state: DataSliceState, {payload}: { payload: { serverId: number, channelId: number, messageId: number } }) {\n    const server = state.servers.find(server => server.id === payload.serverId);\n    if (server === undefined) return;\n    const channels = server.channels.concat(server.groups.map(group => group.channels).flat()).filter(channel => channel.type === ChannelType.Text);\n    const channel = channels.find(channel => channel.id === payload.channelId) as TextChannel | undefined;\n    if (channel === undefined) return;\n    const messageIndex = channel.messages.findIndex(message => message.id === payload.messageId);\n    if (messageIndex === -1) return;\n    channel.messages\n        .filter(message => message.replyId === payload.messageId)\n        .forEach(message =>\n            (message.replyId = null)\n        );\n    channel.messages.splice(messageIndex, 1);\n  },\n  joinVoiceChannel(state: DataSliceState, {payload}: { payload: { serverId: number, groupId: number | null, channelId: number } }) {\n    state.joinedVoiceChannel = payload;\n  },\n  leaveVoiceChannel(state: DataSliceState) {\n    state.joinedVoiceChannel = null;\n  },\n  addChannelUsers(state: DataSliceState, {payload}: { payload: { channelId: number, socketId: string, userId: string }[] }) {\n    const channels = state.servers.map(server => server.channels.concat(server.groups.map(group => group.channels).flat()).filter(channel => channel.type === ChannelType.Voice)).flat();\n    if (channels.length === 0) return;\n    payload.forEach(u1 => {\n      const channel = channels.find(channel => channel.id === u1.channelId) as VoiceChannel | undefined;\n      if (channel === undefined) return;\n      const existingUserIndex = channel.users.findIndex(user => user.userId === u1.userId);\n      if (existingUserIndex === -1)\n        channel.users.push(u1);\n      else\n        channel.users[existingUserIndex] = u1;\n    });\n  },\n};\n\nexport default channelReducers;","import {DataSliceState} from \"state-management/slices/data/data.slice\";\nimport User from \"types/User\";\nimport Channel, {ChannelType, VoiceChannel} from \"types/Channel\";\nimport Server from \"types/Server\";\n\nexport const selectIsBackendInitialized = ({data}: { data: DataSliceState }): boolean => data.isBackendInitialized;\n\nexport const selectSelectedChannel = ({data}: { data: DataSliceState }): Channel | undefined =>\n    data.servers.map(server => server.channels.concat(server.groups.map(group => group.channels).flat()))\n        .flat()\n        .find(channel => channel.id === data.selectedChannel)\n;\n\nexport const selectSelectedServer = ({data}: { data: DataSliceState }): Server | undefined =>\n    data.servers.find(server => server.id === data.selectedServer)\n;\n\nexport const selectOverlay = ({data}: { data: DataSliceState }): { type: string; payload: any; } | null => data.overlay;\n\nexport const selectUsers = ({data}: { data: DataSliceState }): User[] => data.users;\n\nexport const selectJoinedChannel = ({data}: { data: DataSliceState }): VoiceChannel | null => {\n  const joinedVoiceChannel = data.joinedVoiceChannel;\n  if (joinedVoiceChannel === null) return null;\n  const server = data.servers.find(server => server.id === joinedVoiceChannel.serverId);\n  if (server === undefined) return null;\n  if (joinedVoiceChannel.groupId === null) {\n    const foundChannel = server.channels.find(channel => channel.id === joinedVoiceChannel.channelId && channel.type === ChannelType.Voice);\n    if (foundChannel === undefined) return null;\n    return foundChannel as VoiceChannel;\n  } else {\n    const foundGroup = server.groups.find(group => group.id === joinedVoiceChannel.groupId);\n    if (foundGroup === undefined) return null;\n    const foundChannel = server.channels.find(channel => channel.id === joinedVoiceChannel.channelId && channel.type === ChannelType.Voice);\n    if (foundChannel === undefined) return null;\n    return foundChannel as VoiceChannel;\n  }\n};\n\nexport const selectServers = ({data}: { data: DataSliceState }): Server[] => data.servers;","import Server from \"types/Server\";\nimport Message from \"types/Message\";\nimport Channel, {ChannelType, TextChannel} from \"types/Channel\";\nimport User from \"types/User\";\nimport Member from \"types/Member\";\nimport Group from \"types/Group\";\nimport {DataSliceState} from \"state-management/slices/data/data.slice\";\nimport {selectSelectedServer} from \"state-management/selectors/data.selector\";\n\nconst serverReducers = {\n  setInvitation(state: DataSliceState, action: { payload: any, type: string }) {\n    const server = state.servers.find(server => server.id === state.selectedServer);\n    if (server === undefined) return;\n    server.invitation = action.payload;\n  },\n  addServer(state: DataSliceState, {payload: server}: { payload: Server }) {\n    const s1Index = state.servers.findIndex(s1 => s1.id === server.id);\n    if (s1Index === -1)\n      state.servers.push(server);\n    else\n      state.servers[s1Index] = server;\n  },\n  addMessages(state: DataSliceState, {payload: messages}: { payload: Message[] }) {\n    const channels = state.servers\n        .map(server => server.channels\n            .concat(server.groups.map(group => group.channels).flat())\n            .filter(channel => channel.type === ChannelType.Text))\n        .flat();\n    if (channels.length === 0) return;\n    messages.forEach(message => {\n      const channel = channels.find(channel => channel.id === message.channelId) as TextChannel | undefined;\n      if (channel === undefined) return;\n      const messageId = channel.messages.findIndex(m1 => m1.id === message.id);\n      if (messageId === -1)\n        channel.messages.push(message);\n      else\n        channel.messages[messageId] = message;\n    });\n  },\n  addUser(state: DataSliceState, {payload: user}: { payload: User }) {\n    const existingUserIndex = state.users.findIndex(u1 => u1.id === user.id);\n    if (existingUserIndex === -1)\n      state.users.push(user);\n    else\n      state.users[existingUserIndex] = user;\n  },\n  addMember(state: DataSliceState, {payload: member}: { payload: Member }) {\n    const members = state.servers.find(server => server.id === member.serverId)?.members;\n    if (members === undefined) return;\n    const memberIndex = members.findIndex(m1 => m1.id === member.id);\n    if (memberIndex === -1)\n      members.push(member);\n    else\n      members[memberIndex] = member;\n  },\n  addChannel(state: DataSliceState, {payload: channel}: { payload: Channel }) {\n    const server = state.servers.find(server => server.id === channel.serverId);\n    if (server === undefined) return;\n    if (channel.groupId === null) {\n      const channelIndex = server.channels.findIndex(c1 => c1.id === channel.id);\n      if (channelIndex === -1)\n        server.channels.push(channel);\n      else\n        server.channels[channelIndex] = channel;\n    } else {\n      const group = server.groups.find(group => group.id === channel.groupId);\n      if (group === undefined) return;\n      const channelIndex = group.channels.findIndex(c1 => c1.id === channel.id);\n      if (channelIndex === -1)\n        group.channels.push(channel);\n      else\n        group.channels[channelIndex] = channel;\n    }\n  },\n  addGroup(state: DataSliceState, {payload: group}: { payload: Group }) {\n    const server = state.servers.find(server => server.id === group.serverId);\n    if (server === undefined) return;\n    const groupIndex = server.groups.findIndex(g1 => g1.id === group.id);\n    if (groupIndex === -1)\n      server.groups.push(group);\n    else\n      server.groups[groupIndex] = group;\n  },\n  setChannelsOrder(state: DataSliceState, {payload}: { payload: { id: number, order: number, groupId: number | null }[] }) {\n    const server = selectSelectedServer({data: state});\n    if (server === undefined) return;\n    payload.forEach(newChannel => {\n      if (newChannel.groupId === null) {\n        const channel = server.channels.find(channel => channel.id === newChannel.id);\n        if (channel === undefined) return;\n        channel.order = newChannel.order;\n      } else {\n        const group = server.groups.find(group => group.id === newChannel.groupId);\n        if (group === undefined) return;\n        const channel = group.channels.find(channel => channel.id === newChannel.id);\n        if (channel === undefined) return;\n        channel.order = newChannel.order;\n      }\n    });\n  },\n};\n\nexport default serverReducers;","import {createSlice} from \"@reduxjs/toolkit\";\nimport {SliceCaseReducers} from \"@reduxjs/toolkit/src/createSlice\";\nimport Server from \"types/Server\";\nimport User from \"types/User\";\nimport channelReducers from \"state-management/slices/data/channel.reducers\";\nimport serverReducers from \"state-management/slices/data/server.reducers\";\n\nexport type DataSliceState = {\n  isBackendInitialized: boolean,\n  servers: Server[],\n  users: User[],\n  selectedServer: number | null,\n  selectedChannel: number | null,\n  joinedVoiceChannel: { serverId: number, groupId: number | null, channelId: number } | null,\n  overlay: { type: string, payload: any } | null,\n}\n\nconst reducers = {\n  initializeBackend(state: DataSliceState, {\n    payload: {\n      servers,\n      users\n    }\n  }: { payload: { servers: Server[], users: User[] } }) {\n    state.servers = servers;\n    state.users = users;\n    state.isBackendInitialized = true;\n  },\n  setOverlay(state: DataSliceState, {payload: overlay}: { payload: any }) {\n    state.overlay = overlay;\n  },\n  closeOverlay(state: DataSliceState) {\n    state.overlay = null;\n  },\n  selectServer(state: DataSliceState, {payload: serverId}: { payload: number }) {\n    state.selectedChannel = null;\n    state.selectedServer = serverId;\n  },\n  selectChannel(state: DataSliceState, {payload: channelId}: { payload: number }) {\n    state.selectedChannel = channelId;\n  },\n  ...serverReducers,\n  ...channelReducers\n};\n\nexport const dataSlice = createSlice<DataSliceState, SliceCaseReducers<DataSliceState>, string>({\n  name: \"data\",\n  initialState: {\n    isBackendInitialized: false,\n    servers: [],\n    users: [],\n    selectedServer: null,\n    selectedChannel: null,\n    joinedVoiceChannel: null,\n    overlay: null,\n  },\n  reducers\n});\n\nexport const {\n  setChannelsOrder,\n  initializeBackend,\n  setInvitation,\n  closeOverlay,\n  addChannelUsers,\n  joinVoiceChannel,\n  leaveVoiceChannel,\n  selectServer,\n  selectChannel,\n  setOverlay,\n  addServer,\n  addMessages,\n  addMember,\n  addChannel,\n  deleteMessage,\n  editMessage,\n  addGroup,\n  addUser\n} = dataSlice.actions;\n\nexport default dataSlice.reducer;","const config = process.env.REACT_APP_ENVIRONMENT === \"production\" ? {\n      offline: false,\n      backend: \"http://rendezvous-api.zapto.org/\",\n      socketIoUrl: \"http://rendezvous-api.zapto.org/\",\n      keycloak: {\n        url: \"http://rendezvous-iam.zapto.org/auth\",\n        realm: \"capp\",\n        clientId: \"auth-code\",\n      },\n    }\n    :\n    {\n      offline: true,\n      backend: \"http://localhost:3100\",\n      socketIoUrl: \"http://localhost:3100\",\n      keycloak: {\n        url: \"http://localhost:8180/auth\",\n        realm: \"capp\",\n        clientId: \"auth-code\",\n      }\n    };\n\nexport default config;\n","import {Device} from \"mediasoup-client\";\n\nconst mediasoup = new Device();\nconst remoteStream = new MediaStream();\nconst audioContext = new AudioContext();\nconst notificationSound = new Audio(\"/notification.ogg\");\n\nlet created = false;\n\nfunction createMediaStreamSource() {\n  if (created) return;\n  if (remoteStream.getAudioTracks().length === 0) return;\n  created = true;\n  audioContext.createMediaStreamSource(remoteStream).connect(audioContext.destination);\n}\n\nexport {notificationSound, remoteStream, createMediaStreamSource};\nexport default mediasoup;","import config from \"config\";\nimport {io as socketio_io, Socket as socketio_Socket} from \"socket.io-client\";\nimport {DefaultEventsMap, EventNames, EventParams} from \"socket.io-client/build/typed-events\";\nimport mediasoup, {notificationSound} from \"mediasoup\";\nimport {\n  addChannel,\n  addChannelUsers,\n  addGroup,\n  addMember,\n  addMessages,\n  deleteMessage,\n  editMessage\n} from \"state-management/slices/data/data.slice\";\nimport {store} from \"state-management/store\";\nimport {connect} from \"state-management/slices/socketio.slice\";\n\nfunction emitAck<Ev extends EventNames<DefaultEventsMap>>(ev: Ev, ...args: EventParams<DefaultEventsMap, Ev>): Promise<any> {\n  return new Promise(resolve => {\n    if (args.length === 0)\n      return socket.emit(ev, 0, resolve);\n    socket.emit(ev, ...args, resolve);\n  });\n}\n\nclass Socket extends socketio_Socket {\n\n  auth: { [key: string]: any } = {};\n\n  emitAck = emitAck;\n\n}\n\nconst socket: Socket = socketio_io(config.socketIoUrl, {autoConnect: false, transports: [\"websocket\"]}) as Socket;\n\nObject.assign(socket, {emitAck});\n\nsocket.auth = {};\n\nsocket.on(\"connect\", async () => {\n  if (mediasoup.loaded) return;\n  const {routerRtpCapabilities} = await socket.emitAck(`get_router_capabilities`);\n  await mediasoup.load({routerRtpCapabilities});\n  store.dispatch(connect());\n});\n\nsocket.on(\"disconnect\", () => {\n  window.location.reload();\n});\n\nsocket.on(\"new_message\", (payload) => {\n  store.dispatch(addMessages([payload]));\n  if (document.hidden) {\n    notificationSound.currentTime = 0;\n    notificationSound.play();\n  }\n});\n\nsocket.on(\"new_member\", (payload) => {\n  store.dispatch(addMember(payload));\n});\n\nsocket.on(\"new_channel\", (payload) => {\n  store.dispatch(addChannel(payload));\n});\n\nsocket.on(\"new_group\", (payload) => {\n  store.dispatch(addGroup(payload));\n});\n\nsocket.on(\"user_joined_voice-channel\", (payload) => {\n  store.dispatch(addChannelUsers([payload]));\n});\n\nsocket.on(\"message_edited\", (payload) => {\n  store.dispatch(editMessage(payload));\n});\n\nsocket.on(\"message_deleted\", (payload) => {\n  store.dispatch(deleteMessage(payload));\n});\n\nexport default socket;","import {BaseQueryFn, createApi} from \"@reduxjs/toolkit/dist/query/react\";\nimport socket from \"socketio\";\nimport {Processedservers} from \"types/Server\";\nimport Message from \"types/Message\";\n\nconst socketioBaseQuery = (): BaseQueryFn<{\n  ev: string\n  data?: any\n}, any, unknown> => ({ev, data}) => socket.emitAck(ev, data).then(data => ({data}));\n\nexport const socketioApi = createApi({\n  reducerPath: \"socketioApi\",\n  baseQuery: socketioBaseQuery(),\n  endpoints: (builder) => ({\n    getUserData: builder.query<Processedservers, void>({\n      query: () => ({ev: \"get_user_data\"})\n    }),\n    joinServer: builder.query<Processedservers, string>({\n      query: (invitation) => ({ev: \"join_server\", data: {invitation}})\n    }),\n    // TODO\n    createServer: builder.query<Processedservers, string>({\n      query: (name) => ({ev: \"create_server\", data: {name}}),\n    }),\n    // TODO\n    createChannel: builder.query<any, { serverId: number, groupId: number | null, channelName: string }>({\n      query: (data) => ({ev: \"create_channel\", data})\n    }),\n    // TODO\n    createGroup: builder.query<any, { serverId: number, groupName: string }>({\n      query: (data) => ({ev: \"create_group\", data})\n    }),\n    getMessages: builder.query<Message[], { [key: string]: number }>({\n      query: (data) => ({ev: \"get_messages\", data}),\n    }),\n    createInvitation: builder.query<string, number>({\n      query: (serverId) => ({ev: \"create_invitation\", data: {serverId}}),\n      transformResponse: (response: { invitation: string }) => response.invitation\n    }),\n    editMessage: builder.query<string, { serverId: number, channelId: number, messageId: number, text: string }>({\n      query: (data) => ({ev: \"edit_message\", data})\n    }),\n    deleteMessage: builder.query<string, { serverId: number, channelId: number, messageId: number }>({\n      query: (data) => ({ev: \"delete_message\", data})\n    }),\n  }),\n});\n\nexport const {\n  useLazyGetUserDataQuery,\n  useLazyJoinServerQuery,\n  useLazyCreateServerQuery,\n  useLazyCreateChannelQuery,\n  useLazyCreateGroupQuery,\n  useLazyGetMessagesQuery,\n  useLazyCreateInvitationQuery,\n  useLazyEditMessageQuery,\n  useLazyDeleteMessageQuery\n} = socketioApi;","import {Action, configureStore, ThunkAction} from \"@reduxjs/toolkit\";\nimport {TypedUseSelectorHook, useDispatch, useSelector} from \"react-redux\";\nimport keycloakReducer from \"state-management/slices/keycloak.slice\";\nimport socketioReducer from \"state-management/slices/socketio.slice\";\nimport mediasoupReducer from \"state-management/slices/mediasoup.slice\";\nimport dataReducer from \"state-management/slices/data/data.slice\";\nimport {socketioApi} from \"state-management/apis/socketio\";\n\nexport const store = configureStore({\n  reducer: {\n    keycloak: keycloakReducer,\n    socketio: socketioReducer,\n    mediasoup: mediasoupReducer,\n    data: dataReducer,\n    [socketioApi.reducerPath]: socketioApi.reducer,\n  },\n  middleware: getDefaultMiddleware => getDefaultMiddleware()\n      .concat(socketioApi.middleware),\n});\n\nexport const useAppDispatch = () => useDispatch<AppDispatch>();\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;\n\nexport type AppDispatch = typeof store.dispatch;\nexport type RootState = ReturnType<typeof store.getState>;\nexport type AppThunk<ReturnType = void> = ThunkAction<ReturnType,\n    RootState,\n    unknown,\n    Action<string>>;\n","import Keycloak from \"keycloak-js\";\nimport {authenticate, updateToken} from \"state-management/slices/keycloak.slice\";\nimport socket from \"socketio\";\nimport config from \"config\";\nimport {store} from \"state-management/store\";\n\n// @ts-ignore\nconst keycloak: Keycloak.KeycloakInstance = new Keycloak(config.keycloak);\n\nkeycloak.onAuthRefreshSuccess = function () {\n  socket.auth.token = keycloak.token;\n  store.dispatch(updateToken(keycloak.token));\n};\n\nkeycloak.onAuthSuccess = function () {\n  socket.auth.token = keycloak.token;\n  if (!socket.connected) socket.connect();\n  store.dispatch(authenticate(keycloak.token));\n};\n\nexport default keycloak;","import {LoremIpsum} from \"lorem-ipsum\";\nimport {ChannelType} from \"types/Channel\";\n\nconst lorem = new LoremIpsum({\n  sentencesPerParagraph: {\n    max: 8,\n    min: 4\n  },\n  wordsPerSentence: {\n    max: 16,\n    min: 4\n  }\n});\n\nexport const mockUsers = [\n  {\n    id: \"97a8ffc2-10cd-47dd-b915-cf8243d5bfc4\",\n    username: \"user1\",\n    firstName: \"Firstname\",\n    lastName: \"Lastname\"\n  }\n];\n\nconst mockChannels = [\n  {\n    id: 1,\n    serverId: 1,\n    groupId: null,\n    type: ChannelType.Text,\n    name: \"channel 1\",\n    order: 0,\n    messages: new Array(100).fill(0).map((_, index) => ({\n      id: index + 1,\n      serverId: 1,\n      channelId: 1,\n      userId: \"97a8ffc2-10cd-47dd-b915-cf8243d5bfc4\",\n      timestamp: new Date().toString(),\n      text: lorem.generateParagraphs(1),\n      isReply: false,\n      replyId: null\n    }))\n  },\n  {\n    id: 2,\n    serverId: 1,\n    groupId: null,\n    type: ChannelType.Text,\n    name: \"channel 2\",\n    order: 1,\n    messages: new Array(100).fill(0).map((_, index) => ({\n      id: index + 100,\n      serverId: 1,\n      channelId: 2,\n      userId: \"97a8ffc2-10cd-47dd-b915-cf8243d5bfc4\",\n      timestamp: new Date().toString(),\n      text: lorem.generateParagraphs(1),\n      isReply: false,\n      replyId: null\n    }))\n  },\n  {\n    id: 3,\n    serverId: 1,\n    groupId: null,\n    type: ChannelType.Text,\n    name: \"channel 3\",\n    order: 2,\n    messages: new Array(100).fill(0).map((_, index) => ({\n      id: index + 200,\n      serverId: 1,\n      channelId: 3,\n      userId: \"97a8ffc2-10cd-47dd-b915-cf8243d5bfc4\",\n      timestamp: new Date().toString(),\n      text: lorem.generateParagraphs(1),\n      isReply: false,\n      replyId: null\n    }))\n  }\n];\n\nconst mockMembers = [{\n  id: 1,\n  serverId: 1,\n  userId: \"97a8ffc2-10cd-47dd-b915-cf8243d5bfc4\"\n}];\n\nconst mockGroups = [\n  {\n    id: 1,\n    serverId: 1,\n    name: \"Text channels\",\n    channels: [\n      {\n        id: 4,\n        serverId: 1,\n        groupId: 1,\n        type: ChannelType.Text,\n        name: \"channel 4\",\n        order: 0,\n        messages: new Array(100).fill(0).map((_, index) => ({\n          id: index + 300,\n          serverId: 1,\n          channelId: 4,\n          userId: \"97a8ffc2-10cd-47dd-b915-cf8243d5bfc4\",\n          timestamp: new Date().toString(),\n          text: lorem.generateParagraphs(1),\n          isReply: false,\n          replyId: null\n        }))\n      },\n      {\n        id: 5,\n        serverId: 1,\n        groupId: 1,\n        type: ChannelType.Text,\n        name: \"channel 5\",\n        order: 1,\n        messages: new Array(100).fill(0).map((_, index) => ({\n          id: index + 500,\n          serverId: 1,\n          channelId: 5,\n          userId: \"97a8ffc2-10cd-47dd-b915-cf8243d5bfc4\",\n          timestamp: new Date().toString(),\n          text: lorem.generateParagraphs(1),\n          isReply: false,\n          replyId: null\n        }))\n      },\n      {\n        id: 6,\n        serverId: 1,\n        groupId: 1,\n        type: ChannelType.Text,\n        name: \"channel 6\",\n        order: 2,\n        messages: new Array(100).fill(0).map((_, index) => ({\n          id: index + 600,\n          serverId: 1,\n          channelId: 6,\n          userId: \"97a8ffc2-10cd-47dd-b915-cf8243d5bfc4\",\n          timestamp: new Date().toString(),\n          text: lorem.generateParagraphs(1),\n          isReply: false,\n          replyId: null\n        }))\n      }\n    ]\n  }, {\n    id: 2,\n    serverId: 1,\n    name: \"Voice channels\",\n    channels: [\n      {\n        id: 7,\n        serverId: 1,\n        groupId: 2,\n        type: ChannelType.Voice,\n        name: \"channel 7\",\n        order: 0,\n        users: []\n      },\n      {\n        id: 8,\n        serverId: 1,\n        groupId: 2,\n        type: ChannelType.Voice,\n        name: \"channel 8\",\n        order: 1,\n        users: []\n      },\n      {\n        id: 9,\n        serverId: 1,\n        groupId: 2,\n        type: ChannelType.Voice,\n        name: \"channel 9\",\n        order: 2,\n        users: []\n      }\n    ]\n  }];\n\nexport const mockServers = [\n  {\n    id: 1,\n    name: \"Server\",\n    userId: \"97a8ffc2-10cd-47dd-b915-cf8243d5bfc4\",\n    invitation: null,\n    invitationExp: null,\n    channels: mockChannels,\n    groups: mockGroups,\n    members: mockMembers,\n  }\n];\n","import styled from \"styled-components\";\nimport {MouseEventHandler} from \"react\";\n\ntype ComponentProps = {\n  name: string,\n  onSelectServer: MouseEventHandler<HTMLButtonElement>\n}\n\nfunction ServerComponent({name, onSelectServer: selectServer}: ComponentProps) {\n\n  return (\n      <Li className=\"li\">\n        <Button className=\"btn\" type=\"button\" onClick={selectServer}>\n          {name[0]}\n        </Button>\n      </Li>\n  );\n\n}\n\n/* CSS */\n\nexport const Li = styled.li`\n  display: flex;\n  margin: 0.5em 0;\n`;\n\nconst Button = styled.button`\n  background-color: var(--color-secondary);\n  border: thin solid var(--color-secondary);\n  color: white;\n  font-size: 1.5rem;\n  border-radius: 50%;\n  width: 2em;\n  height: 2em;\n`;\n\n/* CSS */\n\nexport default ServerComponent;","import {useAppDispatch, useAppSelector} from \"state-management/store\";\nimport {\n  selectServer as selectServerAction,\n  setOverlay as setOverlayAction\n} from \"state-management/slices/data/data.slice\";\nimport styled from \"styled-components\";\nimport ServerComponent from \"components/server/Server.component\";\nimport Server from \"types/Server\";\nimport {selectServers} from \"state-management/selectors/data.selector\";\n\nfunction ServersPanelComponent() {\n  const dispatch = useAppDispatch();\n  const servers = useAppSelector(selectServers);\n\n  function selectServer(server: Server) {\n    dispatch(selectServerAction(server.id));\n  }\n\n  function setOverlay() {\n    dispatch(setOverlayAction({type: \"AddServerOverlayComponent\"}));\n  }\n\n  return (\n      <Ol className=\"list list__panel\">\n        {servers.map((server: Server) =>\n            <ServerComponent key={`server_${server.id}`} name={server.name}\n                             onSelectServer={() => selectServer(server)}\n            />\n        )}\n        <ServerComponent name={\"+\"} onSelectServer={setOverlay}/>\n      </Ol>\n  );\n\n}\n\n/* CSS */\n\nconst Ol = styled.ol`\n  display: flex;\n  align-items: center;\n  flex-direction: column;\n  background-color: var(--color-primary);\n  width: 4.5em;\n  overflow-y: auto;\n  flex-shrink: 0;\n`;\n\n/* CSS */\n\nexport default ServersPanelComponent;","const ItemTypes = {\n  CHANNEL: \"channel\",\n  GROUP: \"group\"\n};\n\nexport type ChannelDragObject = {\n  id: number,\n  order: number,\n  groupId: number | null\n};\n\nexport {ItemTypes};","import styled from \"styled-components\";\n\nconst DropHandleComponent = styled.div<{ Hidden: boolean }>`\n\n  height: 0.5em;\n  background-color: ${props => props.Hidden ? \"transparent\" : \"green\"};\n\n`;\n\nexport default DropHandleComponent;","import {useCallback, useEffect, useState} from \"react\";\nimport {useDrop} from \"react-dnd\";\nimport {ChannelDragObject, ItemTypes} from \"DnDItemTypes\";\nimport {setChannelsOrder} from \"state-management/slices/data/data.slice\";\nimport {useAppDispatch, useAppSelector} from \"state-management/store\";\nimport DropHandleComponent from \"components/DropHandle.component\";\nimport {selectSelectedServer} from \"state-management/selectors/data.selector\";\n\ntype ComponentProps = {\n  index: number,\n  groupId: number | null\n}\n\nfunction ChannelDropHandleComponent({index, groupId}: ComponentProps) {\n\n  const server = useAppSelector(selectSelectedServer);\n  const [hidden, setHidden] = useState(true);\n  const dispatch = useAppDispatch();\n\n  const handleDrop = useCallback((item: { id: number, order: number, groupId: number | null }) => {\n\n    if (groupId === item.groupId) {\n      // if channel moved inside the same group\n      if (server === undefined) return;\n      if (groupId === null) {\n        if (item.order === index || item.order + 1 === index) return;\n        // if the group is the default one\n        const channels = server.channels.filter(channel => channel.id !== item.id).map(channel => ({\n          id: channel.id,\n          order: channel.order,\n          groupId: null\n        }));\n        if (item.order < index) {\n          channels.forEach(channel => {\n            if (channel.order >= index) channel.order++;\n          });\n          channels.forEach(channel => {\n            if (channel.order > item.order) channel.order--;\n          });\n        } else {\n          channels.forEach(channel => {\n            if (channel.order > item.order) channel.order--;\n          });\n          channels.forEach(channel => {\n            if (channel.order >= index) channel.order++;\n          });\n        }\n        channels.push({id: item.id, order: index, groupId});\n        dispatch(setChannelsOrder(channels));\n      } else {\n        // if the group is some group\n        const group = server.groups.find(group => group.id === groupId);\n        if (group === undefined) return;\n        const channels = group.channels.filter(channel => channel.id !== item.id)\n            .map(channel => ({id: channel.id, order: channel.order, groupId}));\n        if (item.order < index) {\n          channels.forEach(channel => {\n            if (channel.order >= index) channel.order++;\n          });\n          channels.forEach(channel => {\n            if (channel.order > item.order) channel.order--;\n          });\n        } else {\n          channels.forEach(channel => {\n            if (channel.order > item.order) channel.order--;\n          });\n          channels.forEach(channel => {\n            if (channel.order >= index) channel.order++;\n          });\n        }\n        channels.push({id: item.id, order: index, groupId});\n        dispatch(setChannelsOrder(channels));\n      }\n    } else {\n      // if channel moved to another group\n    }\n\n\n  }, [groupId, index, dispatch, server]);\n\n  const handleHover = useCallback(() => {\n    setHidden(false);\n  }, [setHidden]);\n\n  const handleCollect = useCallback((monitor) => {\n    return {\n      isOver: monitor.isOver()\n    };\n  }, []);\n\n  const [props, drop] = useDrop<ChannelDragObject, any, any>({\n    accept: ItemTypes.CHANNEL,\n    drop: handleDrop,\n    hover: handleHover,\n    collect: handleCollect\n  }, [handleDrop, handleHover, handleCollect]);\n\n  useEffect(() => {\n    setHidden(!props.isOver);\n  }, [props]);\n\n  return <DropHandleComponent Hidden={hidden} ref={drop}/>;\n\n}\n\nexport default ChannelDropHandleComponent;","import {ChannelType} from \"types/Channel\";\n\ntype ComponentProps = {\n  type: ChannelType,\n  isPrivate: boolean\n}\n\nfunction ChannelSVG({type, isPrivate}: ComponentProps) {\n\n  if (type === ChannelType.Text)\n    return (\n        isPrivate ?\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n              <path fill=\"currentColor\"\n                    d=\"M14 8C14 7.44772 13.5523 7 13 7H9.76001L10.3657 3.58738C10.4201 3.28107 10.1845 3 9.87344 3H8.88907C8.64664 3 8.43914 3.17391 8.39677 3.41262L7.76001 7H4.18011C3.93722 7 3.72946 7.17456 3.68759 7.41381L3.51259 8.41381C3.45905 8.71977 3.69449 9 4.00511 9H7.41001L6.35001 15H2.77011C2.52722 15 2.31946 15.1746 2.27759 15.4138L2.10259 16.4138C2.04905 16.7198 2.28449 17 2.59511 17H6.00001L5.39427 20.4126C5.3399 20.7189 5.57547 21 5.88657 21H6.87094C7.11337 21 7.32088 20.8261 7.36325 20.5874L8.00001 17H14L13.3943 20.4126C13.3399 20.7189 13.5755 21 13.8866 21H14.8709C15.1134 21 15.3209 20.8261 15.3632 20.5874L16 17H19.5799C19.8228 17 20.0306 16.8254 20.0724 16.5862L20.2474 15.5862C20.301 15.2802 20.0655 15 19.7549 15H16.35L16.6758 13.1558C16.7823 12.5529 16.3186 12 15.7063 12C15.2286 12 14.8199 12.3429 14.7368 12.8133L14.3504 15H8.35045L9.41045 9H13C13.5523 9 14 8.55228 14 8Z\"\n              />\n              <path fill=\"currentColor\"\n                    d=\"M21.025 5V4C21.025 2.88 20.05 2 19 2C17.95 2 17 2.88 17 4V5C16.4477 5 16 5.44772 16 6V9C16 9.55228 16.4477 10 17 10H19H21C21.5523 10 22 9.55228 22 9V5.975C22 5.43652 21.5635 5 21.025 5ZM20 5H18V4C18 3.42857 18.4667 3 19 3C19.5333 3 20 3.42857 20 4V5Z\"\n              />\n            </svg>\n            :\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n              <path fill=\"currentColor\" fillRule=\"evenodd\" clipRule=\"evenodd\"\n                    d=\"M5.88657 21C5.57547 21 5.3399 20.7189 5.39427 20.4126L6.00001 17H2.59511C2.28449 17 2.04905 16.7198 2.10259 16.4138L2.27759 15.4138C2.31946 15.1746 2.52722 15 2.77011 15H6.35001L7.41001 9H4.00511C3.69449 9 3.45905 8.71977 3.51259 8.41381L3.68759 7.41381C3.72946 7.17456 3.93722 7 4.18011 7H7.76001L8.39677 3.41262C8.43914 3.17391 8.64664 3 8.88907 3H9.87344C10.1845 3 10.4201 3.28107 10.3657 3.58738L9.76001 7H15.76L16.3968 3.41262C16.4391 3.17391 16.6466 3 16.8891 3H17.8734C18.1845 3 18.4201 3.28107 18.3657 3.58738L17.76 7H21.1649C21.4755 7 21.711 7.28023 21.6574 7.58619L21.4824 8.58619C21.4406 8.82544 21.2328 9 20.9899 9H17.41L16.35 15H19.7549C20.0655 15 20.301 15.2802 20.2474 15.5862L20.0724 16.5862C20.0306 16.8254 19.8228 17 19.5799 17H16L15.3632 20.5874C15.3209 20.8261 15.1134 21 14.8709 21H13.8866C13.5755 21 13.3399 20.7189 13.3943 20.4126L14 17H8.00001L7.36325 20.5874C7.32088 20.8261 7.11337 21 6.87094 21H5.88657ZM9.41045 9L8.35045 15H14.3504L15.4104 9H9.41045Z\"\n              />\n            </svg>\n    );\n\n  return (\n      isPrivate ?\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n            <path fill=\"currentColor\" fillRule=\"evenodd\" clipRule=\"evenodd\"\n                  d=\"M15 12C15 12.0007 15 12.0013 15 12.002C15 12.553 14.551 13.002 14 13.002V15.002C15.654 15.002 17 13.657 17 12.002C17 12.0013 17 12.0007 17 12H15ZM19 12C19 12.0007 19 12.0013 19 12.002C19 14.759 16.757 17.002 14 17.002V19.002C17.86 19.002 21 15.863 21 12.002C21 12.0013 21 12.0007 21 12H19ZM10.293 3.29604C10.579 3.01004 11.009 2.92504 11.383 3.07904C11.757 3.23204 12 3.59904 12 4.00204V20.002C12 20.407 11.757 20.772 11.383 20.927C11.009 21.082 10.579 20.996 10.293 20.71L6 16.002H3C2.45 16.002 2 15.552 2 15.002V9.00204C2 8.45304 2.45 8.00204 3 8.00204H6L10.293 3.29604Z\"\n            />\n            <path fill=\"currentColor\"\n                  d=\"M21.025 5V4C21.025 2.88 20.05 2 19 2C17.95 2 17 2.88 17 4V5C16.4477 5 16 5.44772 16 6V9C16 9.55228 16.4477 10 17 10H19H21C21.5523 10 22 9.55228 22 9V5.975C22 5.43652 21.5635 5 21.025 5ZM20 5H18V4C18 3.42857 18.4667 3 19 3C19.5333 3 20 3.42857 20 4V5Z\"\n            />\n          </svg>\n          :\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n            <path fill=\"currentColor\" fillRule=\"evenodd\" clipRule=\"evenodd\"\n                  d=\"M11.383 3.07904C11.009 2.92504 10.579 3.01004 10.293 3.29604L6 8.00204H3C2.45 8.00204 2 8.45304 2 9.00204V15.002C2 15.552 2.45 16.002 3 16.002H6L10.293 20.71C10.579 20.996 11.009 21.082 11.383 20.927C11.757 20.772 12 20.407 12 20.002V4.00204C12 3.59904 11.757 3.23204 11.383 3.07904ZM14 5.00195V7.00195C16.757 7.00195 19 9.24595 19 12.002C19 14.759 16.757 17.002 14 17.002V19.002C17.86 19.002 21 15.863 21 12.002C21 8.14295 17.86 5.00195 14 5.00195ZM14 9.00195C15.654 9.00195 17 10.349 17 12.002C17 13.657 15.654 15.002 14 15.002V13.002C14.551 13.002 15 12.553 15 12.002C15 11.451 14.551 11.002 14 11.002V9.00195Z\"\n            />\n          </svg>\n  );\n\n}\n\nexport default ChannelSVG;","import styled from \"styled-components\";\n\nconst ChannelButtonComponent = styled.button`\n  display: flex;\n`;\n\nexport default ChannelButtonComponent;","import {useCallback, useRef} from \"react\";\nimport {useDrag} from \"react-dnd\";\nimport {ChannelDragObject, ItemTypes} from \"DnDItemTypes\";\nimport mediasoup from \"mediasoup\";\nimport socket from \"socketio\";\nimport {joinVoiceChannel} from \"state-management/slices/data/data.slice\";\nimport {useAppDispatch, useAppSelector} from \"state-management/store\";\nimport ChannelSVG from \"svg/Channel.svg\";\nimport config from \"config\";\nimport {VoiceChannel} from \"types/Channel\";\nimport styled from \"styled-components\";\nimport ChannelButtonComponent from \"components/channels/ChannelButton.component\";\nimport {selectUsers} from \"state-management/selectors/data.selector\";\n\ntype ComponentProps = {\n  channel: VoiceChannel\n}\n\nfunction VoiceChannelComponent({channel}: ComponentProps) {\n\n  const users = useAppSelector(selectUsers);\n  const dispatch = useAppDispatch();\n  const joined = useRef(false);\n\n  const createProducer = useCallback(async () => {\n    const localStream = await navigator.mediaDevices.getUserMedia({audio: true});\n    const {transportParameters} = await socket.emitAck(\"create_transport\", {type: \"send\"});\n    const sendTransport = mediasoup.createSendTransport(transportParameters);\n\n    sendTransport.on(\"connect\", ({dtlsParameters}, cb) => {\n      socket.emit(\"connect_transport\", {type: \"send\", dtlsParameters, id: sendTransport.id}, cb);\n    });\n\n    sendTransport.on(\"produce\", async (parameters, cb) => {\n      const {producerId} = await socket.emitAck(\"create_producer\", {\n        id: sendTransport.id,\n        kind: parameters.kind,\n        rtpParameters: parameters.rtpParameters,\n        appData: parameters.appData\n      });\n      cb({id: producerId});\n    });\n    /*const _producer = */\n    await sendTransport.produce({\n      track: localStream?.getAudioTracks()[0]\n    });\n\n  }, []);\n\n  const selectChannel = useCallback(() => {\n    if (config.offline) return;\n    if (joined.current) return;\n    joined.current = true;\n    dispatch(joinVoiceChannel(channel.id));\n    // await createProducer();\n\n    // const usersInVoiceChannel = await socket.emitAck(\"join_voice-channel\", {\n    //   serverId: channel.serverId,\n    //   channelId: channel.id\n    // });\n    // dispatch(addChannelUsers(usersInVoiceChannel));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [joined.current, channel, createProducer]);\n\n  const [, drag] = useDrag<ChannelDragObject, any, any>({\n    type: ItemTypes.CHANNEL,\n    item: {id: channel.id, order: channel.order, groupId: channel.groupId}\n  }, [channel.order]);\n\n  return (\n      <li ref={drag}>\n        <ChannelButtonComponent className=\"btn\" type=\"button\" onClick={selectChannel}>\n          <ChannelSVG type={channel.type} isPrivate={false}/>\n          <span className=\"span\">{channel.name}</span>\n        </ChannelButtonComponent>\n        {\n          <Ul className=\"list\">\n            {\n              channel.users\n                  .map(_user => users.find(user => user.id === _user.userId))\n                  .filter(user => user !== undefined)\n                  .map((user, i) =>\n                      <li className=\"li\" key={`channel_${channel.id}_user${i}`}>{user?.username}</li>\n                  )\n            }\n          </Ul>\n        }\n      </li>\n  );\n\n}\n\n/* CSS */\n\nconst Ul = styled.ul`\n  color: white;\n`;\n\n/* CSS */\n\nexport default VoiceChannelComponent;","import {useCallback, useEffect} from \"react\";\nimport {useDrag} from \"react-dnd\";\nimport config from \"config\";\nimport {ChannelDragObject, ItemTypes} from \"DnDItemTypes\";\nimport {useLazyGetMessagesQuery} from \"state-management/apis/socketio\";\nimport {addMessages, selectChannel as selectChannelAction} from \"state-management/slices/data/data.slice\";\nimport {useAppDispatch} from \"state-management/store\";\nimport ChannelSVG from \"svg/Channel.svg\";\nimport {TextChannel} from \"types/Channel\";\nimport ChannelButtonComponent from \"components/channels/ChannelButton.component\";\n\ntype ComponentProps = {\n  channel: TextChannel\n}\n\nfunction TextChannelComponent({channel}: ComponentProps) {\n\n  const [fetch, {data: messages, isSuccess}] = useLazyGetMessagesQuery();\n  const dispatch = useAppDispatch();\n\n  useEffect(() => {\n    if (!isSuccess) return;\n    if (messages === undefined) return;\n    dispatch(addMessages(messages));\n    dispatch(selectChannelAction(channel.id));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isSuccess]);\n\n  const selectChannel = useCallback(() => {\n    if (!config.offline) {\n      fetch({serverId: channel.serverId, channelId: channel.id, offset: 0});\n      return;\n    }\n    dispatch(selectChannelAction(channel.id));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [channel.id, channel.serverId]);\n\n  const [, drag] = useDrag<ChannelDragObject, any, any>({\n    type: ItemTypes.CHANNEL,\n    item: {id: channel.id, order: channel.order, groupId: channel.groupId}\n  }, [channel.order]);\n\n  return (\n      <li ref={drag}>\n        <ChannelButtonComponent className=\"btn\" type=\"button\" onClick={selectChannel}>\n          <ChannelSVG type={channel.type} isPrivate={false}/>\n          <span className=\"span\">{channel.name}</span>\n        </ChannelButtonComponent>\n      </li>\n  );\n\n}\n\nexport default TextChannelComponent;","import {DataSliceState} from \"state-management/slices/data/data.slice\";\nimport Channel, {ChannelType, TextChannel} from \"types/Channel\";\nimport Server from \"types/Server\";\nimport Message from \"types/Message\";\nimport {selectSelectedServer} from \"state-management/selectors/data.selector\";\n\nexport const selectChannels = (payload: { serverId: number, groupId: number | null, channelId: number }[]) =>\n    ({data}: { data: DataSliceState }): Channel[] => {\n      const foundChannels: Channel[] = [];\n      payload.forEach(requestedChannel => {\n        const foundServer = data.servers.find(server => server.id === requestedChannel.serverId);\n        if (foundServer === undefined) return;\n        addChannel(requestedChannel, foundServer, foundChannels);\n      });\n      return foundChannels;\n    };\n\nexport const selectSelectedServerChannels = (payload: { groupId: number | null, channelId: number }[]) =>\n    ({data}: { data: DataSliceState }): Channel[] => {\n      if (data.selectedServer === null) return [];\n      const server = data.servers.find(server => server.id === data.selectedServer);\n      if (server === undefined) return [];\n      const foundChannels: Channel[] = [];\n      payload.forEach(requestedChannel => {\n        addChannel(requestedChannel, server, foundChannels);\n      });\n      return foundChannels;\n    };\n\nexport const selectSelectedChannelMessages = ({data}: { data: DataSliceState }): Message[] => {\n  if (data.selectedChannel === null) return [];\n  const server = selectSelectedServer({data});\n  if (server === undefined) return [];\n  const foundChannel = server.channels.concat(server.groups.map(group => group.channels).flat())\n      .find(channel => channel.id === data.selectedChannel && channel.type === ChannelType.Text) as TextChannel | undefined;\n  if (foundChannel === undefined) return [];\n  return foundChannel.messages;\n};\n\nexport const selectSelectedServerChannelsByGroupId = (groupId: number | null) =>\n    ({data}: { data: DataSliceState }): Channel[] => {\n      if (data.selectedServer === null) return [];\n      const server = data.servers.find(server => server.id === data.selectedServer);\n      if (server === undefined) return [];\n      if (groupId === null) {\n        return server.channels;\n      } else {\n        const foundGroup = server.groups.find(group => group.id === groupId);\n        if (foundGroup === undefined) return [];\n        return foundGroup.channels;\n      }\n    };\n\nfunction addChannel(requestedChannel: { groupId: number | null, channelId: number }, server: Server, foundChannels: Channel[]) {\n  if (requestedChannel.groupId === null) {\n    const foundChannel = server.channels.find(channel => channel.id === requestedChannel.channelId);\n    if (foundChannel === undefined) return;\n    foundChannels.push(foundChannel);\n  } else {\n    const foundGroup = server.groups.find(group => group.id === requestedChannel.groupId);\n    if (foundGroup === undefined) return;\n    const foundChannel = foundGroup.channels.find(channel => channel.id === requestedChannel.channelId);\n    if (foundChannel === undefined) return;\n    foundChannels.push(foundChannel);\n  }\n}","import ChannelDropHandleComponent from \"components/channels/ChannelDropHandle.component\";\nimport {useAppSelector} from \"state-management/store\";\nimport VoiceChannelComponent from \"components/channels/VoiceChannel.component\";\nimport TextChannelComponent from \"components/channels/TextChannel.component\";\nimport Channel, {ChannelType, TextChannel, VoiceChannel} from \"types/Channel\";\nimport {selectSelectedServerChannelsByGroupId} from \"state-management/selectors/channel.selector\";\n\ntype ComponentProps = {\n  groupId?: number | null\n}\n\nfunction channelMapper(groupId: number | null) {\n\n  return (channel: Channel, index: number) => {\n    return [\n      channel.type === ChannelType.Text ?\n          <TextChannelComponent key={`channel_${channel.id}`} channel={channel as TextChannel}/>\n          :\n          <VoiceChannelComponent key={`channel_${channel.id}`} channel={channel as VoiceChannel}/>\n      ,\n      <ChannelDropHandleComponent key={`drop-handle_${index + 1}`} index={index + 1} groupId={groupId}/>\n    ];\n  };\n}\n\nfunction ChannelsListComponent({groupId = null}: ComponentProps) {\n\n  const channels = useAppSelector(selectSelectedServerChannelsByGroupId(groupId));\n\n  return <>\n    <ChannelDropHandleComponent key={`drop-handle_0`} index={0} groupId={groupId}/>\n    {channels === undefined ||\n    Array.from(channels)\n        .sort((ch1, ch2) => ch1.order - ch2.order)\n        .map(channelMapper(groupId)).flat(2)\n    }</>;\n\n}\n\nexport default ChannelsListComponent;","import {useCallback, useEffect} from \"react\";\nimport {useLazyCreateInvitationQuery} from \"state-management/apis/socketio\";\nimport {setInvitation, setOverlay} from \"state-management/slices/data/data.slice\";\nimport {useAppDispatch, useAppSelector} from \"state-management/store\";\nimport styled from \"styled-components\";\nimport {selectSelectedServer} from \"state-management/selectors/data.selector\";\n\nfunction DropdownComponent({setIsDropdownShown}: any) {\n\n  const selectedServer = useAppSelector(selectSelectedServer);\n  const [fetch, {data: invitation}] = useLazyCreateInvitationQuery();\n  const dispatch = useAppDispatch();\n\n  const createInvitation = useCallback(async () => {\n    if (selectedServer === undefined) return;\n    fetch(selectedServer.id);\n  }, [fetch, selectedServer]);\n\n  useEffect(() => {\n    if (invitation === undefined) return;\n    dispatch(setInvitation(invitation));\n    dispatch(setOverlay({type: \"InvitationOverlayComponent\", payload: {invitation}}));\n    setIsDropdownShown(false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [invitation]);\n\n  const showCreateChannelOverlay = useCallback(async () => {\n    setIsDropdownShown(false);\n    dispatch(setOverlay({type: \"CreateChannelOverlayComponent\", payload: {groupId: null}}));\n  }, [setIsDropdownShown, dispatch]);\n\n  const showCreateGroupOverlay = useCallback(async () => {\n    setIsDropdownShown(false);\n    dispatch(setOverlay({type: \"CreateGroupOverlayComponent\"}));\n  }, [setIsDropdownShown, dispatch]);\n\n  return (\n      <Div>\n        <Ul className=\"list\">\n          <Li>\n            <Button type=\"button\" className=\"btn\" onClick={createInvitation}>\n              Invite people\n            </Button>\n          </Li>\n          <Li>\n            <Button type=\"button\" className=\"btn\" onClick={showCreateChannelOverlay}>\n              Create channel\n            </Button>\n          </Li>\n          <Li>\n            <Button type=\"button\" className=\"btn\" onClick={showCreateGroupOverlay}>\n              Create group\n            </Button>\n          </Li>\n        </Ul>\n\n      </Div>\n  );\n\n}\n\n/* CSS */\n\nconst Div = styled.div`\n  padding: 1em;\n`;\n\nconst Ul = styled.ul`\n  background-color: var(--color-10th);\n  color: var(--color-11th);\n  border-radius: 0.5em;\n  border: solid var(--color-10th);\n  border-width: 0.5em;\n`;\n\nconst Li = styled.li`\n  &:hover {\n    background-color: var(--color-12th);\n    color: white;\n  }\n`;\n\nconst Button = styled.button`\n  color: currentColor;\n  width: 100%;\n  text-align: start;\n`;\n\n/* CSS */\n\nexport default DropdownComponent;","import styled from \"styled-components\";\n\ntype ComponentProps = {\n  isCollapsed?: boolean;\n}\n\nconst SvgArrow = styled.svg<ComponentProps>`\n  transition: transform .2s ease-out, -webkit-transform .2s ease-out;\n  transform: ${props => props.isCollapsed ? \"rotate(-90deg)\" : \"none\"};\n`;\n\nfunction ArrowSVG({isCollapsed = true}: ComponentProps) {\n\n  return (\n      <SvgArrow isCollapsed={isCollapsed} width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n        <path fill=\"currentColor\" fillRule=\"evenodd\" clipRule=\"evenodd\"\n              d=\"M16.59 8.59004L12 13.17L7.41 8.59004L6 10L12 16L18 10L16.59 8.59004Z\"\n        />\n      </SvgArrow>\n  );\n\n}\n\nfunction ArrowXSVG({isCollapsed = true}: ComponentProps) {\n  return (\n      <SvgArrow isCollapsed={isCollapsed} width=\"18\" height=\"18\">\n        <g fill=\"none\" fillRule=\"evenodd\">\n          <path d=\"M0 0h18v18H0\"/>\n          <path stroke=\"currentColor\" d=\"M4.5 4.5l9 9\" strokeLinecap=\"round\"/>\n          <path stroke=\"currentColor\" d=\"M13.5 4.5l-9 9\" strokeLinecap=\"round\"/>\n        </g>\n      </SvgArrow>\n  );\n}\n\nexport {ArrowSVG, ArrowXSVG};","import {useState} from \"react\";\nimport ChannelsListComponent from \"components/channels/ChannelsList.component\";\nimport {ArrowSVG} from \"svg/Arrow.svg\";\nimport {setOverlay} from \"state-management/slices/data/data.slice\";\nimport {useAppDispatch} from \"state-management/store\";\nimport styled from \"styled-components\";\n\ntype ComponentProps = {\n  id: number,\n  name: string\n}\n\nfunction GroupComponent({id, name}: ComponentProps) {\n\n  const [isCollapsed, setIsExpanded] = useState(true);\n  const dispatch = useAppDispatch();\n\n\n  function createChannel() {\n    dispatch(setOverlay({type: \"CreateChannelOverlayComponent\", payload: {groupId: id}}));\n  }\n\n  return (\n      <li>\n        <Div>\n          <Button className=\"btn\" type=\"button\" onClick={() => setIsExpanded(!isCollapsed)}>\n            <ArrowSVG isCollapsed={isCollapsed}/>\n            <span>{name}</span>\n          </Button>\n          <ButtonCreateChannel type=\"button\" className=\"btn\" onClick={createChannel}>+</ButtonCreateChannel>\n        </Div>\n        {\n          isCollapsed ||\n          <ol className=\"list\">\n              <ChannelsListComponent groupId={id}/>\n          </ol>\n        }\n      </li>\n  );\n\n}\n\n/* CSS */\n\nconst Button = styled.button`\n  display: flex;\n  flex-grow: 1;\n  color: var(--color-9th)\n`;\n\nconst Div = styled.div`\n  display: flex;\n  /*flex-direction: column;*/\n  align-items: center;\n`;\nconst ButtonCreateChannel = styled.button`\n  font-size: 1.5em;\n`;\n\n/* CSS */\n\nexport default GroupComponent;\n\n","import {DataSliceState} from \"state-management/slices/data/data.slice\";\nimport {selectSelectedServer} from \"state-management/selectors/data.selector\";\nimport Group from \"types/Group\";\nimport Member from \"types/Member\";\n\nexport const selectSelectedServerGroups = ({data}: { data: DataSliceState }): Group[] => {\n  const selectedServer = selectSelectedServer({data});\n  if (selectedServer === undefined) return [];\n  return selectedServer.groups;\n};\n\nexport const selectSelectedServerMembers = ({data}: { data: DataSliceState }): Member[] => {\n  const selectedServer = selectSelectedServer({data});\n  if (selectedServer === undefined) return [];\n  return selectedServer.members;\n};","import GroupComponent from \"components/group/Group.component\";\nimport {useAppSelector} from \"state-management/store\";\nimport Group from \"types/Group\";\nimport {selectSelectedServerGroups} from \"state-management/selectors/server.selector\";\n\nfunction GroupsListComponent() {\n\n  const groups = useAppSelector(selectSelectedServerGroups);\n\n  return <>{\n    groups.map((group: Group) =>\n        <GroupComponent key={`group_${group.id}`} id={group.id} name={group.name}/>\n    )\n  }</>;\n\n}\n\nexport default GroupsListComponent;","import {useState} from \"react\";\nimport ChannelsListComponent from \"components/channels/ChannelsList.component\";\nimport {DndProvider} from \"react-dnd\";\nimport {HTML5Backend} from \"react-dnd-html5-backend\";\nimport {useAppSelector} from \"state-management/store\";\nimport DropdownComponent from \"components/dropdown/Dropdown.component\";\nimport GroupsListComponent from \"components/group/GroupsList.component\";\nimport styled from \"styled-components\";\nimport {ArrowXSVG} from \"svg/Arrow.svg\";\nimport {selectSelectedServer} from \"state-management/selectors/data.selector\";\n\nfunction ChannelsPanelComponent() {\n\n  const [isDropdownShown, setIsDropdownShown] = useState(false);\n  const selectedServer = useAppSelector(selectSelectedServer);\n\n  function toggleDropdown() {\n    setIsDropdownShown(!isDropdownShown);\n  }\n\n  return (\n      <Div>\n        <Button className=\"btn\" type=\"button\"\n                onClick={toggleDropdown}>\n          {\n            selectedServer === undefined ||\n            <>\n                <Span>{selectedServer.name}</Span>\n                <ArrowXSVG isCollapsed={!isDropdownShown}/>\n            </>\n          }\n        </Button>\n        {!isDropdownShown || <DropdownComponent setIsDropdownShown={setIsDropdownShown}/>}\n        <DndProvider backend={HTML5Backend}>\n          <ol className=\"list\">\n            {selectedServer === undefined ||\n            <>\n                <ChannelsListComponent/>\n                <GroupsListComponent/>\n            </>\n            }\n          </ol>\n        </DndProvider>\n      </Div>\n  );\n\n}\n\n/* CSS */\n\nconst Div = styled.div`\n  flex-shrink: 0;\n  background-color: var(--color-third);\n  width: 15em;\n`;\n\nconst Span = styled.span`\n  flex-grow: 1;\n`;\n\nconst Button = styled.button`\n  background: none;\n  font-size: 1.5em;\n  text-align: left;\n  width: 100%;\n\n  border-style: none;\n  box-shadow: var(--small-shadow-bar);\n  display: flex;\n  align-items: center;\n  height: 2em;\n  color: var(--color-9th)\n`;\n\n/* CSS */\n\nexport default ChannelsPanelComponent;","function MembersSVG() {\n\n  return (\n      <svg x=\"0\" y=\"0\" className=\"\" aria-hidden=\"false\" width=\"24\" height=\"24\"\n           viewBox=\"0 0 24 24\">\n        <path fill=\"currentColor\" fillRule=\"evenodd\" clipRule=\"evenodd\"\n              d=\"M14 8.00598C14 10.211 12.206 12.006 10 12.006C7.795 12.006 6 10.211 6 8.00598C6 5.80098 7.794 4.00598 10 4.00598C12.206 4.00598 14 5.80098 14 8.00598ZM2 19.006C2 15.473 5.29 13.006 10 13.006C14.711 13.006 18 15.473 18 19.006V20.006H2V19.006Z\"\n        />\n        <path fill=\"currentColor\" fillRule=\"evenodd\" clipRule=\"evenodd\"\n              d=\"M14 8.00598C14 10.211 12.206 12.006 10 12.006C7.795 12.006 6 10.211 6 8.00598C6 5.80098 7.794 4.00598 10 4.00598C12.206 4.00598 14 5.80098 14 8.00598ZM2 19.006C2 15.473 5.29 13.006 10 13.006C14.711 13.006 18 15.473 18 19.006V20.006H2V19.006Z\"\n        />\n        <path fill=\"currentColor\"\n              d=\"M20.0001 20.006H22.0001V19.006C22.0001 16.4433 20.2697 14.4415 17.5213 13.5352C19.0621 14.9127 20.0001 16.8059 20.0001 19.006V20.006Z\"\n        />\n        <path fill=\"currentColor\"\n              d=\"M14.8834 11.9077C16.6657 11.5044 18.0001 9.9077 18.0001 8.00598C18.0001 5.96916 16.4693 4.28218 14.4971 4.0367C15.4322 5.09511 16.0001 6.48524 16.0001 8.00598C16.0001 9.44888 15.4889 10.7742 14.6378 11.8102C14.7203 11.8418 14.8022 11.8743 14.8834 11.9077Z\"\n        />\n      </svg>\n  );\n\n}\n\nexport default MembersSVG;","import styled from \"styled-components\";\nimport {useEffect, useRef, useState} from \"react\";\nimport {useAppDispatch} from \"state-management/store\";\nimport {\n  deleteMessage as deleteMessageAction,\n  editMessage as editMessageAction\n} from \"state-management/slices/data/data.slice\";\nimport {useLazyDeleteMessageQuery, useLazyEditMessageQuery} from \"state-management/apis/socketio\";\nimport config from \"config\";\n\ntype ComponentProps = {\n  serverId: number,\n  channelId: number,\n  messageId: number,\n  username: string,\n  timestamp: string,\n  text: string,\n  isReply: boolean,\n  replyId: number | null\n  reply: any\n}\n\nfunction MessageComponent({\n                            serverId,\n                            channelId,\n                            messageId,\n                            username,\n                            timestamp,\n                            text,\n                            isReply,\n                            replyId,\n                            reply\n                          }: ComponentProps) {\n\n  const time = new Date(timestamp);\n  const [actions, setActions] = useState(false);\n  const dispatch = useAppDispatch();\n  const [fetchEditMessage, {\n    isFetching: isFetchingEditMessage,\n    isSuccess: isSuccessEditMessage\n  }] = useLazyEditMessageQuery();\n  const [fetchDeleteMessage, {\n    isFetching: isFetchingDeleteMessage,\n    isSuccess: isSuccessDeleteMessage\n  }] = useLazyDeleteMessageQuery();\n  const [isEditing, setIsEditing] = useState(false);\n  const textRef = useRef<HTMLSpanElement>(null);\n  const [oldMessage, setOldMessage] = useState(\"\");\n\n  function onMouseEnter() {\n    setActions(true);\n  }\n\n  function onMouseLeave() {\n    setActions(false);\n  }\n\n  function editMode() {\n    if (isEditing) {\n      if (textRef.current === null) return;\n      textRef.current.innerText = oldMessage;\n      setIsEditing(false);\n    } else {\n      if (textRef.current === null) return;\n      setOldMessage(textRef.current.innerText);\n      setIsEditing(true);\n    }\n  }\n\n  function editMessage() {\n    if (!config.offline) {\n      fetchEditMessage({serverId, channelId, messageId, text: textRef.current?.innerText || \"\"});\n    }\n  }\n\n  function deleteMessage() {\n    if (!config.offline) {\n      fetchDeleteMessage({serverId, channelId, messageId});\n    } else {\n      dispatch(deleteMessageAction({serverId, channelId, messageId}));\n    }\n  }\n\n  useEffect(() => {\n    if (!isSuccessEditMessage || isFetchingEditMessage) return;\n    dispatch(editMessageAction({serverId, channelId, messageId, text: textRef.current?.innerText}));\n    setIsEditing(false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isSuccessEditMessage, isFetchingEditMessage]);\n\n  useEffect(() => {\n    if (!isFetchingDeleteMessage || isSuccessDeleteMessage) return;\n    dispatch(deleteMessageAction({serverId, channelId, messageId}));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isFetchingDeleteMessage, isSuccessDeleteMessage]);\n\n  return (\n      <DivContainer onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave}>\n        {!actions ||\n        <DivActions>\n            <button type=\"button\" onClick={editMode}>E</button>\n            <button type=\"button\" onClick={() => reply(messageId)}>R</button>\n            <button type=\"button\" onClick={deleteMessage}>D</button>\n        </DivActions>\n        }\n        {\n          !isReply ||\n          <div>{\n            replyId === null ?\n                \"message has been deleted\"\n                :\n                `replied to ${replyId}`\n          }</div>\n        }\n        <Div>\n          <Time dateTime={time.toISOString()}>\n            {time.getHours()} : {time.getMinutes()}\n          </Time>\n          <SpanUsername>{username}</SpanUsername>\n          <DivMessageContainer>\n            <SpanMessage suppressContentEditableWarning contentEditable={isEditing} ref={textRef}>{text}</SpanMessage>\n            {\n              !isEditing ||\n              <button type=\"button\" onClick={editMessage}>Save</button>\n            }\n          </DivMessageContainer>\n        </Div>\n      </DivContainer>\n  );\n\n}\n\n/* CSS */\n\nconst DivMessageContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n`;\n\nconst DivContainer = styled.div`\n  position: relative;\n`;\n\nconst DivActions = styled.div`\n  position: absolute;\n  right: 1em;\n  background: blue;\n`;\n\nconst Div = styled.div`\n  display: flex;\n`;\n\nconst Time = styled.time`\n  margin: 0 1em;\n  flex-shrink: 0;\n`;\n\nconst SpanUsername = styled.span`\n  font-weight: 1000;\n  flex-shrink: 0;\n`;\n\nconst SpanMessage = styled.span`\n  margin: 0 1em;\n`;\n\n/* CSS */\n\nexport default MessageComponent;\n","function PlusSVG() {\n\n  return (\n      <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n        <path fill=\"currentColor\"\n              d=\"M12 2.00098C6.486 2.00098 2 6.48698 2 12.001C2 17.515 6.486 22.001 12 22.001C17.514 22.001 22 17.515 22 12.001C22 6.48698 17.514 2.00098 12 2.00098ZM17 13.001H13V17.001H11V13.001H7V11.001H11V7.00098H13V11.001H17V13.001Z\"\n        />\n      </svg>\n  );\n\n}\n\nexport default PlusSVG;","import styled from \"styled-components\";\nimport {ClipboardEvent, useCallback} from \"react\";\n\ntype ComponentProps = {\n  onKeyDown: any,\n  onKeyUp: any,\n  onClick: any\n}\n\nfunction MessageInputComponent({onKeyDown, onKeyUp, onClick}: ComponentProps) {\n\n  const onCopy = useCallback((event: ClipboardEvent<HTMLSpanElement>) => {\n    event.preventDefault();\n    const selection = getSelection();\n    const clipboard = event.clipboardData;\n    if (selection === null || clipboard === null) return;\n    clipboard.setData(\"text/plain\", selection.toString());\n  }, []);\n\n  return (\n      <Span\n          role=\"textbox\"\n          contentEditable\n          onKeyDown={onKeyDown}\n          onKeyUp={onKeyUp}\n          onCopy={onCopy}\n          onClick={onClick}\n      />\n  );\n}\n\n/* CSS */\n\nconst Span = styled.span`\n  background: none;\n  border: none;\n  flex-grow: 1;\n  word-wrap: anywhere;\n  max-height: inherit;\n  overflow-y: auto;\n  align-self: center;\n\n  &:focus {\n    outline: none;\n  }\n`;\n\n/* CSS */\n\nexport default MessageInputComponent;","function GIFSVG() {\n\n  return (\n      <svg width=\"24\" height=\"24\" aria-hidden=\"false\" viewBox=\"0 0 24 24\" className=\"svg__emoji\">\n        <path fill=\"currentColor\"\n              d=\"M2 2C0.895431 2 0 2.89543 0 4V20C0 21.1046 0.89543 22 2 22H22C23.1046 22 24 21.1046 24 20V4C24 2.89543 23.1046 2 22 2H2ZM9.76445 11.448V15.48C8.90045 16.044 7.88045 16.356 6.74045 16.356C4.11245 16.356 2.66045 14.628 2.66045 12.072C2.66045 9.504 4.23245 7.764 6.78845 7.764C7.80845 7.764 8.66045 8.004 9.32045 8.376L9.04445 10.164C8.42045 9.768 7.68845 9.456 6.83645 9.456C5.40845 9.456 4.71245 10.512 4.71245 12.06C4.71245 13.62 5.43245 14.712 6.86045 14.712C7.31645 14.712 7.64045 14.616 7.97645 14.448V12.972H6.42845V11.448H9.76445ZM11.5481 7.92H13.6001V16.2H11.5481V7.92ZM20.4724 7.92V9.636H17.5564V11.328H19.8604V13.044H17.5564V16.2H15.5164V7.92H20.4724Z\"\n        />\n      </svg>\n  );\n\n}\n\nexport default GIFSVG;","// @ts-ignore\nimport TrieSearch from \"trie-search\";\n\nconst trie = new TrieSearch([], {\n  ignoreCase: false,\n  splitOnRegEx: false,\n  expandRegexes: [],\n  min: 3\n});\n\n\nconst emojis = [\n  {emoji: String.fromCodePoint(0x1F600), shortcut: \"grinning_face\"},\n  {emoji: String.fromCodePoint(0x1F603), shortcut: \"grinning_face_with_big_eyes\"},\n  {emoji: String.fromCodePoint(0x1F604), shortcut: \"grinning_face_with_smiling_eyes\"},\n  {emoji: String.fromCodePoint(0x1F601), shortcut: \"beaming_face_with_smiling_eyes\"},\n  {emoji: String.fromCodePoint(0x1F606), shortcut: \"grinning_squinting_face\"},\n  {emoji: String.fromCodePoint(0x1F605), shortcut: \"grinning_face_with_sweat\"},\n  {emoji: String.fromCodePoint(0x1F923), shortcut: \"rolling_on_the_floor_laughing\"},\n  {emoji: String.fromCodePoint(0x1F602), shortcut: \"face_with_tears_of_joy\"},\n  {emoji: String.fromCodePoint(0x1F642), shortcut: \"slightly_smiling_face\"},\n  {emoji: String.fromCodePoint(0x1F643), shortcut: \"upside-down_face\"},\n  {emoji: String.fromCodePoint(0x1FAE0), shortcut: \"melting_face\"},\n  {emoji: String.fromCodePoint(0x1F609), shortcut: \"winking_face\"},\n  {emoji: String.fromCodePoint(0x1F60A), shortcut: \"smiling_face_with_smiling_eyes\"},\n  {emoji: String.fromCodePoint(0x1F607), shortcut: \"smiling_face_with_halo\"},\n];\n\nemojis.forEach(emoji => {\n  trie.map(`:${emoji.shortcut}`, emoji.emoji);\n});\n\nexport {emojis};\nexport default trie;","import styled from \"styled-components\";\nimport {forwardRef, useImperativeHandle, useState} from \"react\";\nimport {emojis} from \"trie\";\n\ntype ComponentProps = {\n  foundEmojis: any[]\n}\n\nconst EmojiContainerComponent = forwardRef(({foundEmojis}: ComponentProps, ref) => {\n\n  const [curIndex, setCurIndex] = useState(0);\n\n  useImperativeHandle(ref, () => ({\n    move: (up: boolean) => {\n      if (up) {\n        if (curIndex - 1 === -1) {\n          setCurIndex(foundEmojis.length - 1);\n        } else {\n          setCurIndex(curIndex - 1);\n        }\n      } else {\n        if (curIndex + 1 === foundEmojis.length) {\n          setCurIndex(0);\n        } else {\n          setCurIndex(curIndex + 1);\n        }\n      }\n    },\n    getEmoji: () => {\n      return foundEmojis[curIndex];\n    }\n  }));\n\n  return (<>{\n    foundEmojis.map((result: any, index: number) =>\n        // @ts-ignore\n        (<Div key={`emoji_${index}`} highlighted={index === curIndex}>\n          <div>{result}</div>\n          <div>{emojis.find(emoji => emoji.emoji === result)?.shortcut}</div>\n        </Div>)\n    )\n  }</>);\n});\n\n/* CSS */\n\nconst Div = styled.div`\n  display: flex;\n  align-content: space-between;\n\n  background-color: ${(props: any) => props.highlighted ? \"blue\" : \"red\"};\n`;\n\n/* CSS */\n\nexport default EmojiContainerComponent;","import PlusSVG from \"svg/Plus.svg\";\nimport MessageInputComponent from \"components/message/MessageInput.component\";\nimport GIFSVG from \"svg/GIF.svg\";\nimport styled from \"styled-components\";\nimport {useCallback, useRef, useState} from \"react\";\nimport EmojiContainerComponent from \"components/message/EmojiContainer.component\";\nimport trie from \"trie\";\nimport {addMessages} from \"state-management/slices/data/data.slice\";\nimport {useAppDispatch, useAppSelector} from \"state-management/store\";\nimport socket from \"socketio\";\nimport {selectSelectedChannel} from \"state-management/selectors/data.selector\";\n\ntype ComponentProps = {\n  isReplying: boolean,\n  replyId?: number,\n  messageSent: any,\n}\n\nfunction MessageInputContainerComponent({isReplying, replyId, messageSent}: ComponentProps) {\n\n  const emojiRef = useRef<any>(null);\n  const [isEmojiShown, setIsEmojiShown] = useState(false);\n  const [foundEmojis, setFoundEmojis] = useState<any[]>([]);\n  const selectedChannel = useAppSelector(selectSelectedChannel);\n  const dispatch = useAppDispatch();\n\n  const sendInputFieldContent = useCallback(async (event: any) => {\n    event.preventDefault();\n    if (selectedChannel === undefined) return;\n    let message = (event.target as any).innerText;\n    (event.target as any).innerText = \"\";\n    let payload: {\n      channelId: number,\n      message: string,\n      isReply: boolean,\n      replyId: number | null,\n    } = {\n      channelId: selectedChannel.id,\n      message,\n      isReply: false,\n      replyId: null\n    };\n    if (isReplying) {\n      if (replyId === undefined) return;\n      payload.isReply = true;\n      payload.replyId = replyId;\n    }\n    message = await socket.emitAck(\"send_message\", payload);\n    messageSent();\n    dispatch(addMessages([message]));\n  }, [dispatch, isReplying, messageSent, replyId, selectedChannel])\n\n  function findLastIndexOfColon(event: any) {\n    const selection = getSelection();\n    if (selection === null) return;\n    const cursorPosition = selection.anchorOffset;\n    let message = event.target.innerText as string | undefined;\n    if (message === undefined) return;\n    // find last \":\" until cursor position\n    const lastIndexOfColon = message.lastIndexOf(\":\", cursorPosition);\n    if (lastIndexOfColon === -1) return;\n    return {\n      selection,\n      cursorPosition,\n      message,\n      lastIndexOfColon,\n    };\n  }\n\n  const shouldDisplayEmojiPanel = useCallback((event: any) => {\n    const lastIndexObject = findLastIndexOfColon(event);\n    if (lastIndexObject === undefined) return;\n    let {cursorPosition, message, lastIndexOfColon} = lastIndexObject;\n    // from \":\" to cursor position\n    message = message.substring(lastIndexOfColon, cursorPosition);\n    const indexOfSpace = message.indexOf(\" \");\n    // if command contains white spaces return\n    if (indexOfSpace !== -1) return;\n    if (message.charCodeAt(message.length - 1) === 160) return;\n    const emojis = trie.search(message);\n    if (emojis.length === 0) return;\n    return emojis;\n  }, []);\n\n  const onKeyDown = useCallback((event) => {\n    if (emojiRef.current === null) return;\n    if ([\"ArrowDown\", \"ArrowUp\"].includes(event.code)) {\n      event.preventDefault();\n      emojiRef.current.move(event.code === \"ArrowUp\");\n      return;\n    }\n    if (!event.code.includes(\"Enter\")) return;\n    if (!isEmojiShown)\n      return sendInputFieldContent(event);\n    event.preventDefault();\n    const lastIndexObject = findLastIndexOfColon(event);\n    if (lastIndexObject === undefined) return;\n    let {selection, cursorPosition, message, lastIndexOfColon} = lastIndexObject;\n    event.target.innerText = `${message.substring(0, lastIndexOfColon)}${emojiRef.current.getEmoji()}${message.substring(cursorPosition + 1)}`;\n    selection.setPosition(selection.focusNode, 1);\n    setFoundEmojis([]);\n    setIsEmojiShown(false);\n    return;\n\n  }, [isEmojiShown, sendInputFieldContent]);\n\n  const shouldDisplayEmojiPanelEventHandler = useCallback((event) => {\n    const emojis = shouldDisplayEmojiPanel(event);\n    if (emojis !== undefined) {\n      setIsEmojiShown(true);\n      setFoundEmojis(emojis);\n      return;\n    }\n    setIsEmojiShown(false);\n    setFoundEmojis([]);\n  }, [shouldDisplayEmojiPanel]);\n\n  return <>\n    {\n      !isEmojiShown ||\n      <EmojiContainerComponent ref={emojiRef} foundEmojis={foundEmojis}/>\n    }\n    <Footer>\n      <button type=\"button\" className=\"btn btn--off btn--hover btn__icon\">\n        <PlusSVG/>\n      </button>\n      <MessageInputComponent\n          onKeyDown={onKeyDown}\n          onKeyUp={shouldDisplayEmojiPanelEventHandler}\n          onClick={shouldDisplayEmojiPanelEventHandler}\n      />\n      <button type=\"button\" className=\"btn btn--off btn--hover btn__icon\">\n        <GIFSVG/>\n      </button>\n      <button type=\"button\" className=\"btn btn__icon\">\n        <DivEmoji/>\n      </button>\n    </Footer>\n  </>;\n\n}\n\n/* CSS */\n\nconst Footer = styled.footer`\n  background-color: var(--color-fifth);\n  border-radius: 0.5em;\n  max-height: 12.5em;\n  margin: 0 1em 1.5em 1em;\n  display: flex;\n  align-items: flex-start;\n`;\n\nconst DivEmoji = styled.div`\n  background-image: url(\"assets/emojis.png\");\n  background-position: 0 0;\n  background-size: 242px 110px;\n  background-repeat: no-repeat;\n  width: 22px;\n  height: 22px;\n  transform: scale(1);\n  filter: grayscale(100%);\n\n  &:hover {\n    transform: scale(1.14);\n    filter: grayscale(0%);\n  }\n`;\n\n/* CSS */\n\nexport default MessageInputContainerComponent;","import {useCallback, useEffect, useRef, useState} from \"react\";\nimport MessageComponent from \"components/message/Message.component\";\nimport {useAppDispatch, useAppSelector} from \"state-management/store\";\nimport {addMessages, selectChannel as selectChannelAction,} from \"state-management/slices/data/data.slice\";\nimport styled from \"styled-components\";\nimport {useLazyGetMessagesQuery} from \"state-management/apis/socketio\";\nimport config from \"config\";\nimport MessageInputContainerComponent from \"components/message/MessageInputContainer.component\";\nimport {selectSelectedChannel, selectUsers} from \"state-management/selectors/data.selector\";\nimport {selectSelectedChannelMessages} from \"state-management/selectors/channel.selector\";\n\nfunction MessagesPanelComponent() {\n\n  const messagesList = useRef<HTMLDivElement>(null);\n  const messages = useAppSelector(selectSelectedChannelMessages);\n  const users = useAppSelector(selectUsers);\n  const channel = useAppSelector(selectSelectedChannel);\n  const [fetch, {data, isSuccess, status}] = useLazyGetMessagesQuery();\n  const dispatch = useAppDispatch();\n  // const [offset, setOffset] = useState(2040);\n  const [offset, setOffset] = useState(0);\n  const [beginning, setBeginning] = useState(false);\n  const [isReplying, setIsReplying] = useState(false);\n  const [replyId, setReplyId] = useState<number | undefined>();\n\n  useEffect(() => {\n    messagesList.current?.scroll(0, messagesList.current.scrollHeight);\n  }, [messages]);\n\n  useEffect(() => {\n    if (!isSuccess || status !== \"fulfilled\") return;\n    if (channel === undefined || data === undefined) return;\n\n    if (data.length === 0) {\n      setBeginning(true);\n      return;\n    }\n    dispatch(addMessages(data));\n    dispatch(selectChannelAction(channel.id));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [status]);\n\n  const onScroll = useCallback(() => {\n    if (channel === undefined) return;\n    if (messagesList.current?.scrollTop === 0) {\n      if (beginning) return;\n      if (!config.offline) {\n        fetch({serverId: channel.serverId, channelId: channel.id, offset: offset});\n        setOffset(offset + 30);\n        return;\n      }\n    }\n  }, [channel, fetch, offset, beginning]);\n\n  function reply(messageId: number) {\n    setReplyId(messageId);\n    setIsReplying(true);\n  }\n\n  function messageSent() {\n    setReplyId(undefined);\n    setIsReplying(false);\n  }\n\n  return (\n      <DivBodyMain>\n        <DivBodyMessages ref={messagesList} onScroll={onScroll}>\n          <Ol className=\"list\">\n            {//.sort((m1, m2) => Date.parse(m1.timestamp) - Date.parse(m2.timestamp))\n              messages.map(message =>\n                  <MessageComponent key={`message_${message.id}`}\n                                    serverId={message.serverId}\n                                    channelId={message.channelId}\n                                    messageId={message.id}\n                                    username={users.find(user => user.id === message.userId)?.username || \"\"}\n                                    text={message.text}\n                                    timestamp={message.timestamp}\n                                    isReply={message.isReply}\n                                    replyId={message.replyId}\n                                    reply={reply}\n                  />\n              ).sort((a, b) => Date.parse(a.props.timestamp) - Date.parse(b.props.timestamp))\n            }\n          </Ol>\n        </DivBodyMessages>\n        {\n          !isReplying ||\n          <div>replying</div>\n        }\n        <MessageInputContainerComponent isReplying={isReplying} replyId={replyId} messageSent={messageSent}/>\n      </DivBodyMain>\n  );\n\n}\n\n/* CSS */\n\nconst Ol = styled.ol`\n  word-break: break-all;\n`;\n\nconst DivBodyMain = styled.div`\n  flex-grow: 1;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst DivBodyMessages = styled.div`\n  flex-grow: 1;\n  overflow-x: hidden;\n`;\n\n/* CSS */\n\nexport default MessagesPanelComponent;","type ComponentProps = {\n  name: string\n}\n\nfunction MemberComponent({name}: ComponentProps) {\n  return (\n      <li>\n        {name}\n      </li>\n  );\n}\n\nexport default MemberComponent;\n","import MemberComponent from \"./Member.component\";\nimport {useAppSelector} from \"state-management/store\";\nimport styled from \"styled-components\";\nimport {selectUsers} from \"state-management/selectors/data.selector\";\nimport {selectSelectedServerMembers} from \"state-management/selectors/server.selector\";\n\nfunction MembersPanelComponent() {\n\n  const users = useAppSelector(selectUsers);\n  const selectedMembers = useAppSelector(selectSelectedServerMembers);\n\n  return (\n      <Div>\n        <ol className=\"list\">\n          {\n            selectedMembers.map(member =>\n                <MemberComponent key={`member_${member.id}`}\n                                 name={users.find(user => user.id === member.userId)?.firstName || \"\"}\n                />\n            )\n          }\n        </ol>\n      </Div>\n  );\n\n}\n\n/* CSS */\n\nconst Div = styled.div`\n  width: var(--members-panel-width);\n  background-color: var(--color-third);\n  height: 100%;\n  flex-shrink: 0;\n`;\n\n/* CSS */\n\nexport default MembersPanelComponent;","import {useState} from \"react\";\nimport ChannelSVG from \"svg/Channel.svg\";\nimport MembersSVG from \"svg/Members.svg\";\nimport {useAppSelector} from \"state-management/store\";\nimport MessagesPanelComponent from \"components/message/MessagesPanel.component\";\nimport MembersPanelComponent from \"components/member/MembersPanel.component\";\nimport {ChannelType} from \"types/Channel\";\nimport styled from \"styled-components\";\nimport {selectSelectedChannel} from \"state-management/selectors/data.selector\";\n\nfunction ContentPanelComponent() {\n\n  const [isMembersSelected, setIsMembersSelected] = useState(true);\n\n  const selectedChannel = useAppSelector(selectSelectedChannel);\n\n  return (\n      <DivContainer>\n        <Header>\n          <DivHeader>\n            {\n              selectedChannel === undefined ||\n              <>\n                  <ChannelSVG type={ChannelType.Text} isPrivate={false}/>\n                  <Span>{selectedChannel.name}</Span>\n              </>\n            }\n            <button type=\"button\" className={`btn ${isMembersSelected ? \"btn--active\" : \"btn--off\"} btn--hover`}\n                    onClick={() => setIsMembersSelected(!isMembersSelected)}>\n              <MembersSVG/>\n            </button>\n          </DivHeader>\n          <DivMembers>\n            placeholder\n          </DivMembers>\n        </Header>\n        <DivContentBody>\n          <MessagesPanelComponent/>\n          {\n            !isMembersSelected ||\n            <MembersPanelComponent/>\n          }\n        </DivContentBody>\n      </DivContainer>\n  );\n\n}\n\n/* CSS */\n\nconst Span = styled.span`\n  flex-grow: 1;\n`;\n\nconst DivContainer = styled.div`\n  flex-grow: 1;\n  background-color: var(--color-secondary);\n  color: white;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst DivMembers = styled.div`\n  width: var(--members-panel-width);\n`;\n\nconst DivContentBody = styled.div`\n  display: flex;\n  flex-grow: 1;\n  max-height: calc(100% - 3em);\n`;\n\nconst Header = styled.header`\n  display: flex;\n  align-items: center;\n  height: 3em;\n  box-shadow: var(--small-shadow-bar);\n`;\n\nconst DivHeader = styled.div`\n  flex-grow: 1;\n  display: flex;\n`;\n\n/* CSS */\n\nexport default ContentPanelComponent;","import {setOverlay} from \"state-management/slices/data/data.slice\";\nimport {useAppDispatch} from \"state-management/store\";\n\nfunction AddServerOverlayComponent() {\n  const dispatch = useAppDispatch();\n\n  function createServer() {\n    dispatch(setOverlay({type: \"CreateServerOverlayComponent\"}));\n  }\n\n  function joinServer() {\n    dispatch(setOverlay({type: \"JoinServerOverlayComponent\"}));\n  }\n\n  return (\n      <div className=\"overlay\">\n        <div className=\"overlay__container\">\n          <h1 className=\"h1\">Add a server</h1>\n          <div className=\"overlay__body\">\n            <button type=\"button\" className=\"btn btn__overlay-select\" onClick={createServer}>Create a server</button>\n            <button type=\"button\" className=\"btn btn__overlay-select\" onClick={joinServer}>Join a server</button>\n          </div>\n        </div>\n      </div>\n  );\n\n}\n\nexport default AddServerOverlayComponent;","import {useEffect, useRef} from \"react\";\nimport config from \"config\";\nimport {useLazyCreateChannelQuery} from \"state-management/apis/socketio\";\nimport {addChannel, selectChannel, setOverlay} from \"state-management/slices/data/data.slice\";\nimport {useAppDispatch, useAppSelector} from \"state-management/store\";\nimport {ChannelType, TextChannel} from \"types/Channel\";\nimport {selectSelectedServer} from \"state-management/selectors/data.selector\";\n\ntype ComponentProps = {\n  groupId?: number | null\n}\n\nfunction CreateChannelOverlayComponent({groupId = null}: ComponentProps) {\n\n  const ref = useRef<HTMLInputElement>(null);\n  const selectedServer = useAppSelector(selectSelectedServer);\n  const [fetch, {data, isSuccess}] = useLazyCreateChannelQuery();\n  const dispatch = useAppDispatch();\n\n  function createChannel() {\n    if (config.offline) return;\n    if (selectedServer === undefined) return;\n    // TODO\n    const channelName = ref.current?.value as string;\n    fetch({serverId: selectedServer.id, groupId, channelName});\n  }\n\n  useEffect(() => {\n    if (selectedServer === undefined) return;\n    if (!isSuccess) return;\n    if (data === undefined) return;\n    const channelName = ref.current?.value as string;\n    const channel: TextChannel = {\n      id: data?.channelId,\n      serverId: selectedServer.id,\n      groupId,\n      type: ChannelType.Text,\n      name: channelName,\n      messages: [],\n      order: 0\n    };\n    dispatch(addChannel(channel));\n    dispatch(selectChannel(channel.id));\n    dispatch(setOverlay(null));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isSuccess]);\n\n  return (\n      <div className=\"overlay\">\n        <div className=\"overlay__container\">\n          <h1 className=\"h1\">Channel name</h1>\n          <input type=\"text\" ref={ref}/>\n          <button type=\"button\" className=\"btn btn__overlay-select\" onClick={createChannel}>Create\n          </button>\n        </div>\n      </div>\n  );\n}\n\nexport default CreateChannelOverlayComponent;","import {useEffect, useRef} from \"react\";\nimport config from \"config\";\nimport {useLazyCreateGroupQuery} from \"state-management/apis/socketio\";\nimport {useAppSelector} from \"state-management/store\";\nimport {selectSelectedServer} from \"state-management/selectors/data.selector\";\n\nfunction CreateGroupOverlayComponent() {\n\n  const ref = useRef<HTMLInputElement>(null);\n  const selectedServer = useAppSelector(selectSelectedServer);\n  const [fetch, {data}] = useLazyCreateGroupQuery();\n\n  function createGroup() {\n    if (config.offline) return;\n    if (selectedServer === undefined) return;\n    const groupName = ref.current?.value as string;\n    fetch({serverId: selectedServer.id, groupName});\n  }\n\n  useEffect(() => {\n    if (data === undefined) return;\n    if (selectedServer === undefined) return;\n    // const groupName = ref.current?.value as string;\n    // dispatch(setGroup({\n    //   id: data.groupId,\n    //   serverId: selectedServer.id,\n    //   name: groupName\n    // }));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [data]);\n\n  return (\n      <div className=\"overlay\">\n        <div className=\"overlay__container\">\n          <h1 className=\"h1\">Group name</h1>\n          <input type=\"text\" ref={ref}/>\n          <button type=\"button\" className=\"btn btn__overlay-select\" onClick={createGroup}>Create\n          </button>\n        </div>\n      </div>\n  );\n}\n\nexport default CreateGroupOverlayComponent;","import {useEffect, useRef} from \"react\";\nimport {useLazyCreateServerQuery} from \"state-management/apis/socketio\";\nimport {addServer, addUser, setOverlay} from \"state-management/slices/data/data.slice\";\nimport {useAppDispatch} from \"state-management/store\";\n\nfunction CreateServerOverlayComponent() {\n  const dispatch = useAppDispatch();\n  const ref = useRef<HTMLInputElement>(null);\n  const [fetch, {data, isSuccess}] = useLazyCreateServerQuery();\n\n  function createServer() {\n    fetch(ref.current?.value as string);\n  }\n\n  useEffect(() => {\n    if (!isSuccess) return;\n    if (data === undefined) return;\n    dispatch(setOverlay(null));\n    dispatch(addServer(data.servers[0]));\n    dispatch(addUser(data.users[0]));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isSuccess]);\n\n  return (\n      <div className=\"overlay\">\n        <div className=\"overlay__container\">\n          <h1 className=\"h1\">Create a server</h1>\n          <div className=\"overlay__body\">\n            <input type=\"text\" ref={ref}/>\n            <button type=\"button\" className=\"btn btn__overlay-select\" onClick={createServer}>Create\n            </button>\n          </div>\n        </div>\n      </div>\n  );\n\n}\n\nexport default CreateServerOverlayComponent;","import {useCallback, useState} from \"react\";\nimport {setOverlay} from \"state-management/slices/data/data.slice\";\nimport {useAppDispatch} from \"state-management/store\";\n\ntype ComponentProps = {\n  invitation: string\n}\n\nfunction InvitationOverlayComponent({invitation}: ComponentProps) {\n\n  const [status, setStatus] = useState(\"Copy\");\n  const dispatch = useAppDispatch();\n\n  const copyToClipboard = useCallback(async () => {\n    try {\n      await navigator.clipboard.writeText(invitation);\n      setStatus(\"Copied\");\n    } catch (e) {\n      console.error(e);\n      setStatus(\"Error\");\n    }\n  }, [invitation]);\n\n  function close() {\n    dispatch(setOverlay(null));\n  }\n\n  return (\n      <div className=\"overlay\">\n        <div className=\"overlay__container\">\n          <button type=\"button\" onClick={close}>X</button>\n          <h1 className=\"h1\">Share the invitation with a friend</h1>\n          <div className=\"overlay__body\">\n            <span className=\"span\">{invitation}</span>\n            <button type=\"button\" className=\"btn btn__overlay-select\" onClick={copyToClipboard}>\n              {status}\n            </button>\n          </div>\n        </div>\n      </div>\n  );\n\n}\n\nexport default InvitationOverlayComponent;","import {useEffect, useRef} from \"react\";\nimport {useLazyJoinServerQuery} from \"state-management/apis/socketio\";\nimport {addServer, addUser, setOverlay} from \"state-management/slices/data/data.slice\";\nimport {useAppDispatch} from \"state-management/store\";\n\nfunction JoinServerOverlayComponent() {\n\n  const ref = useRef<HTMLInputElement>(null);\n  const [fetch, {data, isSuccess}] = useLazyJoinServerQuery();\n  const dispatch = useAppDispatch();\n\n  function joinServer() {\n    fetch(ref.current?.value as string);\n  }\n\n  useEffect(() => {\n    if (!isSuccess) return;\n    if (data === undefined) return;\n    dispatch(addServer(data.servers[0]));\n    dispatch(addUser(data.users[0]));\n    dispatch(setOverlay(null));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isSuccess]);\n\n  return (\n      <div className=\"overlay\">\n        <div className=\"overlay__container\">\n          <h1 className=\"h1\">Join a server</h1>\n          <div className=\"overlay__body\">\n            <input type=\"text\" ref={ref}/>\n            <button type=\"button\" className=\"btn btn__overlay-select\" onClick={joinServer}>Join\n            </button>\n          </div>\n        </div>\n      </div>\n  );\n\n}\n\nexport default JoinServerOverlayComponent;","import {useEffect} from \"react\";\nimport {useAppDispatch, useAppSelector} from \"state-management/store\";\nimport {selectAuthenticated} from \"state-management/slices/keycloak.slice\";\nimport keycloak from \"keycloak\";\nimport {selectConnected} from \"state-management/slices/socketio.slice\";\nimport config from \"config\";\nimport {mockServers, mockUsers} from \"mock-data\";\nimport {initializeBackend,} from \"state-management/slices/data/data.slice\";\nimport ServersPanelComponent from \"components/server/ServersPanel.component\";\nimport {useLazyGetUserDataQuery} from \"state-management/apis/socketio\";\nimport ChannelsPanelComponent from \"components/channels/ChannelsPanel.component\";\nimport ContentPanelComponent from \"components/content/ContentPanel.component\";\nimport AddServerOverlayComponent from \"components/overlay/AddServerOverlay.component\";\nimport CreateChannelOverlayComponent from \"components/overlay/CreateChannelOverlay.component\";\nimport CreateGroupOverlayComponent from \"components/overlay/CreateGroupOverlay.component\";\nimport CreateServerOverlayComponent from \"components/overlay/CreateServerOverlay.component\";\nimport InvitationOverlayComponent from \"components/overlay/InvitationOverlay.component\";\nimport JoinServerOverlayComponent from \"components/overlay/JoinServerOverlay.component\";\nimport {\n  selectIsBackendInitialized,\n  selectJoinedChannel,\n  selectOverlay,\n  selectSelectedServer\n} from \"state-management/selectors/data.selector\";\n\nfunction AppComponent() {\n\n  const authenticated = useAppSelector(selectAuthenticated);\n  const connected = useAppSelector(selectConnected);\n  const isBackendInitialized = useAppSelector(selectIsBackendInitialized);\n  const selectedServer = useAppSelector(selectSelectedServer);\n  const overlay = useAppSelector(selectOverlay);\n  const joinedChannel = useAppSelector(selectJoinedChannel);\n  const [fetch, {data, isSuccess, status}] = useLazyGetUserDataQuery();\n  const dispatch = useAppDispatch();\n  // const users = channel.users?.filter(user => user.userId !== subject)\n  //     .filter(user => !consumers.find(consumer => user.socketId === consumer.socketId));\n  // // create consumers\n  // if (users === undefined) return;\n  // createMediaStreamSource();\n  // (async () => {\n  //   for (const user of users) {\n  //     const {transportParameters} = await socket.emitAck(\"create_transport\", {type: \"recv\"});\n  //     const recvTransport = mediasoup.createRecvTransport(transportParameters);\n  //     recvTransport.on(\"connect\", ({dtlsParameters}, cb) => {\n  //       socket.emit(\"connect_transport\", {type: \"recv\", dtlsParameters, id: recvTransport.id}, cb);\n  //     });\n  //     const {consumerParameters} = await socket.emitAck(\"create_consumer\", {\n  //       transportId: recvTransport.id,\n  //       socketId: user.socketId,\n  //       rtpCapabilities: mediasoup.rtpCapabilities\n  //     });\n  //     const consumer = await recvTransport.consume(consumerParameters);\n  //     remoteStream.addTrack(consumer.track);\n  //     socket.emit(\"resume_consumer\", {id: consumer.id});\n  //     consumers.push({socketId: user.socketId, consumer});\n  //   }\n  // })();\n  useEffect(() => {\n    if (joinedChannel === null) {\n      //disconnect\n      return;\n    }\n\n  }, [joinedChannel, selectedServer]);\n\n  useEffect(() => {\n    if (config.offline) return;\n    if (authenticated) return;\n    keycloak.init({\n      onLoad: \"check-sso\",\n      silentCheckSsoRedirectUri: window.location.origin + \"/silent-check-sso.html\"\n    })\n        .then((authenticated: boolean) => {\n          if (!authenticated) {\n            return keycloak.login();\n          }\n        }).catch(() => {\n      alert(\"failed to initialize\");\n    });\n  }, [authenticated]);\n\n  useEffect(() => {\n    if (config.offline) {\n      const processedServerData = {\n        servers: mockServers,\n        users: mockUsers\n      };\n      dispatch(initializeBackend(processedServerData));\n      return;\n    }\n    if (!connected) return;\n    if (isBackendInitialized) return;\n    fetch();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isBackendInitialized, connected]);\n\n  useEffect(() => {\n    if (!isSuccess) return;\n    if (data === undefined) return;\n    dispatch(initializeBackend(data));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [status]);\n\n  return (\n      <>\n        {/*((!initialized || !keycloak.authenticated) && !config.offline) ||*/}\n        {\n          overlay === null ||\n          overlayToComponent(overlay)\n        }\n        <ServersPanelComponent/>\n        <ChannelsPanelComponent/>\n        <ContentPanelComponent/>\n      </>\n  );\n\n}\n\nfunction overlayToComponent({type, payload}: { type: string, payload: any }) {\n  switch (type) {\n    case \"AddServerOverlayComponent\":\n      return <AddServerOverlayComponent/>;\n    case \"CreateChannelOverlayComponent\":\n      return <CreateChannelOverlayComponent groupId={payload.groupId}/>;\n    case \"CreateGroupOverlayComponent\":\n      return <CreateGroupOverlayComponent/>;\n    case \"CreateServerOverlayComponent\":\n      return <CreateServerOverlayComponent/>;\n    case \"InvitationOverlayComponent\":\n      return <InvitationOverlayComponent invitation={payload.invitation}/>;\n    case \"JoinServerOverlayComponent\":\n      return <JoinServerOverlayComponent/>;\n  }\n}\n\nexport default AppComponent;\n\n","function AuthProvider({children}: any) {\n  // if (process.env.REACT_APP_ENVIRONMENT === \"production\") {\n  //   return (\n  //       <Auth0Provider\n  //           domain=\"rendezvous-iam.eu.auth0.com\"\n  //           clientId=\"l1ZnZCOMXFKzMO0plbn0dl4o6Ijyg0se\"\n  //           redirectUri={window.location.origin}\n  //       >\n  //         {children}\n  //       </Auth0Provider>\n  //   );\n  // }\n  return children;\n\n}\n\nexport default AuthProvider;","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"index.css\";\nimport reportWebVitals from \"reportWebVitals\";\nimport AppComponent from \"components/app/App.component\";\nimport {store} from \"state-management/store\";\nimport {Provider} from \"react-redux\";\nimport AuthProvider from \"components/AuthProvider.component\";\n\nReactDOM.render(\n    <React.StrictMode>\n      <AuthProvider>\n        <Provider store={store}>\n          <AppComponent/>\n        </Provider>\n      </AuthProvider>\n    </React.StrictMode>,\n    document.getElementById(\"root\")\n);\n\n\nreportWebVitals();\n"],"sourceRoot":""}